(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/js/main.js":[function(require,module,exports){
'use strict';

var w = window.innerWidth * window.devicePixelRatio,
    h = window.innerHeight * window.devicePixelRatio;

//var game = new Phaser.Game((h > w) ? h : w, (h > w) ? w : h, Phaser.AUTO, 'naapurinkauhu-game');
var game = new Phaser.Game(1024, 768, Phaser.AUTO, 'naapurinkauhu-game');

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game'
}

game.state.add('Boot', require('./states/boot'));
//game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('GameOver', require('./states/gameover'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\boot.js","./states/game":"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\game.js","./states/gameover":"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\gameover.js","./states/menu":"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\menu.js","./states/preloader":"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\preloader.js","./utils":"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\utils.js"}],"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\entities\\enemy.js":[function(require,module,exports){
var Enemy = function (game, x, y) {

    Phaser.Sprite.call(this, game, x, y, 'enemySprite');
		game.add.existing(this);
		this.animations.add('run');
		this.animations.play('run', 25, true);
}

Enemy.prototype = Object.create(Phaser.Sprite.prototype);
Enemy.prototype.constructor = Enemy;

/**
 * Automatically called by World.update
 */
Enemy.prototype.update = function() {
	this.move();

};

Enemy.prototype.move = function() {
	this.y += 1.7;
};

module.exports = Enemy;

},{}],"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    //this.game.input.maxPointers = 1;

    this.input.maxPointers = 1;
    this.stage.disableVisibilityChange = true;

    if (this.game.device.desktop)
    {
        this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
        this.scale.setMinMax(480, 260, 1024, 768);
        this.scale.pageAlignHorizontally = true;
        this.scale.pageAlignVertically = true;
        this.scale.setScreenSize(true);
        this.scale.refresh();
    }
    else
    {
        this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
        this.scale.setMinMax(480, 260, 1024, 768);
        this.scale.pageAlignHorizontally = true;
        this.scale.pageAlignVertically = true;
        this.scale.forceOrientation(true, false);
        this.scale.setResizeCallback(this.gameResized, this);
        this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation, this);
        this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation, this);
        this.scale.setScreenSize(true);
        this.scale.refresh();
    }

    this.game.state.start('Preloader');
  },

  gameResized: function (width, height) {

        //  This could be handy if you need to do any extra processing if the game resizes.
        //  A resize could happen if for example swapping orientation on a device or resizing the browser window.
        //  Note that this callback is only really useful if you use a ScaleMode of RESIZE and place it inside your main game state.

    },

    enterIncorrectOrientation: function () {

        BasicGame.orientated = false;

        document.getElementById('orientation').style.display = 'block';

    },

    leaveIncorrectOrientation: function () {

        BasicGame.orientated = true;

        document.getElementById('orientation').style.display = 'none';

    }
};

},{}],"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\game.js":[function(require,module,exports){
var Enemy = require('../entities/enemy');

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    this.grassTileSprite = this.game.add.tileSprite(0, 0, this.game.width, this.game.height, 'dark_grass');
    this.sandTilesprite = this.game.add.tileSprite(0, this.game.height - 70, this.game.width, 50, 'earth');

    this.enemysSoldiers = [];
    this.soldiers = [];
    this.enemySoldiersCount = 5;
    this.soldiersCount = 10;
    this.gameover = false;

    this.soldiersLeftText = this.add.bitmapText(0, 20, 'minecraftia', this.soldiersCount.toString() );
    this.soldiersLeftText.x = this.game.width - this.soldiersLeftText.textWidth - 20;

    // Bullets
    this.fireRate = 50;
    this.nextFire = 10;

    this.bullets = this.game.add.group();
    this.bullets.enableBody = true;
    this.bullets.physicsBodyType = Phaser.Physics.ARCADE;

    this.bullets.createMultiple(100, 'bullet');
    this.bullets.setAll('checkWorldBounds', true);
    this.bullets.setAll('outOfBoundsKill', true);

    this.sprite = this.game.add.sprite(this.game.width / 2, this.game.height - 70, 'turret');
    this.sprite.anchor.set(0.5);

    this.game.physics.enable(this.sprite, Phaser.Physics.ARCADE);

    this.sprite.body.allowRotation = false;

    // Enemy animations 
    this.enemyDyingAnimations = this.game.add.group();

    for (var i = 0; i < 500; i++)
    {
        var enemyDyingAnimation = this.enemyDyingAnimations.create(0, 0, 'enemydying', [0], false);
        enemyDyingAnimation.anchor.setTo(0, -0.25);
        enemyDyingAnimation.animations.add('enemydying');
    }

    // concentratedFire
    this.explosions = this.game.add.group();
    this.explosions.enableBody = true;
    this.explosions.physicsBodyType = Phaser.Physics.ARCADE;
    for (var j = 0; j < 10; j++)
    {
        var explosionAnimation = this.explosions.create(0, 0, 'smallExplosion', [0], false);
        explosionAnimation.anchor.setTo(0.5, 0.5);
        explosionAnimation.animations.add('smallExplosion');
    }

    /*this.bot = this.game.add.sprite(100, 100, 'enemySprite');
    this.bot.animations.add('run');
    this.bot.animations.play('run', 25, true);*/

    this.concentratedFireButton = this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

  },

  update: function () {

    if(this.gameover) return;

    if(this.enemysSoldiers.length < this.enemySoldiersCount){
      this.createEnemy();
    }

    for (var i = this.enemysSoldiers.length - 1; i >= 0; i--) {
      var enemy = this.enemysSoldiers[i];

      this.game.physics.arcade.overlap(this.bullets, this.enemysSoldiers[i], this.bulletHitEnemy, null, this);
      
      //this.game.physics.arcade.overlap(this.explosions, this.enemysSoldiers[i], this.hitEnemy, null, this);


      //this.enemysSoldiers[i].update();
      if(enemy.y >= this.game.height - 70) {
        this.soldiersCount -= 1;
        enemy.destroy();
        this.enemysSoldiers.splice(i,1);
        this.soldiersLeftText.setText(this.soldiersCount.toString());

        
        var enemyDyingAnimation = this.enemyDyingAnimations.getFirstExists(false);
        enemyDyingAnimation.reset(enemy.x, enemy.y);
        //enemyDyingAnimation.play('kaboom', 30, false, true);

        if(this.soldiersCount <= 0){
          //console.log("PELI LOPPU!");
          this.game.state.start('GameOver');
        }
      }

    }

    this.sprite.rotation = this.game.physics.arcade.angleToPointer(this.sprite);
    if (this.game.input.activePointer.isDown)
    {
      this.fire();
    }

    if (this.concentratedFireButton.isDown) {
       this.concentratedFire(this.game.input.activePointer.x - 100,this.game.input.activePointer.y - 100);
    }

    //this.game.debug.spriteBounds(this.explosions);
    //this.game.debug.spriteCorners(this.explosions, true, true);

  },

  fire: function () {
    if (this.game.time.now > this.nextFire && this.bullets.countDead() > 0)
        {
            this.nextFire = this.game.time.now + this.fireRate;

            var bullet = this.bullets.getFirstDead();

            bullet.reset(this.sprite.x - 8, this.sprite.y - 8);

            this.game.physics.arcade.moveToPointer(bullet, 1500);
            bullet.rotation = this.game.physics.arcade.moveToPointer(bullet, 2500, this.game.input.activePointer, 400);
        }
  },

  concentratedFire: function (x,y) {
        console.log(this.explosions.x);

        for (var i = this.explosions.length - 1; i >= 0; i--) {
          var explosionsAnimation = this.explosions.getAt(i);
          explosionsAnimation.reset(x + Math.random()*200, y + Math.random()*200);
          //enemyDyingAnimation.reset(x, y);
          explosionsAnimation.play('smallExplosion', 30, false, true);
          console.log('---------------------');
          console.log(explosionsAnimation.x);
          console.log(explosionsAnimation.y);
        }

        for (var j = this.enemysSoldiers.length - 1; j >= 0; j--) {
          var enemy = this.enemysSoldiers[j];
 
          this.game.physics.arcade.overlap(this.explosions, enemy, this.hitEnemy, null, this);
          
        }
  },

  bulletHitEnemy: function (enemy, bullet) {
      bullet.kill();

      for (var i = this.enemysSoldiers.length - 1; i >= 0; i--) {
        if(enemy === this.enemysSoldiers[i])
        {
          this.enemysSoldiers.splice(i,1);

          var enemyDyingAnimation = this.enemyDyingAnimations.getFirstExists(false);
          enemyDyingAnimation.reset(enemy.x, enemy.y);
          enemyDyingAnimation.play('enemydying', 30, false, false);
          this.game.time.events.add(Phaser.Timer.SECOND * 1, this.killAnimation, this, enemyDyingAnimation);
        }
      }
      
      enemy.kill();

      //var destroyed = enemies[tank.name].damage();

      /*if (destroyed)
      {
          var explosionAnimation = explosions.getFirstExists(false);
          explosionAnimation.reset(tank.x, tank.y);
          explosionAnimation.play('kaboom', 30, false, true);
      }*/
  },

  killAnimation: function (animation) {
    console.log('enemyDyingAnimation');
    this.game.add.tween(animation).to( { alpha: 0 }, 1000, Phaser.Easing.Linear.None, true);
  },

  hitEnemy: function (enemy) {
    //console.log('HIT!');
    for (var i = this.enemysSoldiers.length - 1; i >= 0; i--) {
      if(enemy === this.enemysSoldiers[i])
      {
        this.enemysSoldiers.splice(i,1);

        var enemyDyingAnimation = this.enemyDyingAnimations.getFirstExists(false);
        enemyDyingAnimation.reset(enemy.x, enemy.y);
        enemyDyingAnimation.play('enemydying', 30, false, false);
      }
    }
    enemy.kill();
  },

  createEnemy: function () {
    var enemy = new Enemy(this.game, this.game.world.randomX, 0);
    this.game.physics.enable(enemy, Phaser.Physics.ARCADE);
    this.enemysSoldiers.push(enemy);
    
  },

  checkOverlap: function (spriteA, spriteB) {
    var boundsA = spriteA.getBounds();
    var boundsB = spriteB.getBounds();

    return Phaser.Rectangle.intersects(boundsA, boundsB);
  },

  endGame: function () {
    
  },

  onInputDown: function () {
    this.game.state.start('Menu');
  }
};

},{"../entities/enemy":"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\entities\\enemy.js"}],"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\gameover.js":[function(require,module,exports){
var Gameover = function () {};

module.exports = Gameover;

Gameover.prototype = {

  create: function () {
    var x = this.game.width / 2
      , y = this.game.height / 2;

    this.titleTxt = this.add.bitmapText(x, y, 'minecraftia', 'Killed: ' );
    this.titleTxt.align = 'center';
    this.titleTxt.x = this.game.width / 2 - this.titleTxt.textWidth / 2;

    y = y + this.titleTxt.height + 5;
    this.startTxt = this.add.bitmapText(x, y, 'minecraftia', 'GAME OVER');
    this.startTxt.align = 'center';
    this.startTxt.x = this.game.width / 2 - this.startTxt.textWidth / 2;
    
    this.input.onDown.add(this.onDown, this);
  },

  update: function () {

  },

  onDown: function () {
    this.game.state.start('Menu');
    //this.game.state.start('Gameover');
  }
};

},{}],"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2
      , y = this.game.height / 2;

    this.titleTxt = this.add.bitmapText(x, y, 'minecraftia', 'Naapurinkauhu' );
    this.titleTxt.align = 'center';
    this.titleTxt.x = this.game.width / 2 - this.titleTxt.textWidth / 2;

    this.startTxt = this.add.bitmapText(x, y + this.titleTxt.height + 5, 'minecraftia', 'Press screen to start');
    this.startTxt.align = 'center';
    this.startTxt.x = this.game.width / 2 - this.startTxt.textWidth / 2;

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {

  },

  onDown: function () {
    this.game.state.start('Game');
    //this.game.scale.startFullScreen();
  }
};

},{}],"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\states\\preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(this.game.width / 2, this.game.height / 2, 'preloader');
      this.asset.anchor.setTo(0.5, 0.5);

      this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
      this.load.setPreloadSprite(this.asset);
      this.load.spritesheet('kaboom', 'assets/explosion.png', 64, 64, 23);
      this.load.spritesheet('bigExplosion', 'assets/big-explosion.png', 256, 128, 12);
      this.load.spritesheet('smallExplosion', 'assets/small-explosion.png', 96, 96, 48);
      this.load.spritesheet('enemydying', 'assets/enemydying.png', 63, 64, 20);
      this.load.spritesheet('enemySprite', 'assets/enemy.png', 64, 64, 15);
      this.load.image('dark_grass', 'assets/dark_grass.png');
      this.load.image('earth', 'assets/earth.png');
      this.load.image('enemy', 'assets/invader.png');
      this.load.image('turret', 'assets/turret.png');
      this.load.image('bullet', 'assets/bullet.png');
      this.load.bitmapFont('minecraftia', 'assets/minecraftia.png', 'assets/minecraftia.xml');
      this.load.audio('sfx', 'assets/audio/SoundEffects/fx_mixdown.ogg');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
        this.game.state.start('Menu');
      }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],"C:\\Projects\\games\\lsg-naapurin-kauhu-up\\src\\js\\utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["./src/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlc1xcYnJvd3NlcmlmeVxcbm9kZV9tb2R1bGVzXFxicm93c2VyLXBhY2tcXF9wcmVsdWRlLmpzIiwic3JjXFxqc1xcbWFpbi5qcyIsInNyY1xcanNcXGVudGl0aWVzXFxlbmVteS5qcyIsInNyY1xcanNcXHN0YXRlc1xcYm9vdC5qcyIsInNyY1xcanNcXHN0YXRlc1xcZ2FtZS5qcyIsInNyY1xcanNcXHN0YXRlc1xcZ2FtZW92ZXIuanMiLCJzcmNcXGpzXFxzdGF0ZXNcXG1lbnUuanMiLCJzcmNcXGpzXFxzdGF0ZXNcXHByZWxvYWRlci5qcyIsInNyY1xcanNcXHV0aWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciB3ID0gd2luZG93LmlubmVyV2lkdGggKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyxcclxuICAgIGggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcclxuXHJcbi8vdmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoKGggPiB3KSA/IGggOiB3LCAoaCA+IHcpID8gdyA6IGgsIFBoYXNlci5BVVRPLCAnbmFhcHVyaW5rYXVodS1nYW1lJyk7XHJcbnZhciBnYW1lID0gbmV3IFBoYXNlci5HYW1lKDEwMjQsIDc2OCwgUGhhc2VyLkFVVE8sICduYWFwdXJpbmthdWh1LWdhbWUnKTtcclxuXHJcbndpbmRvdy5VdGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKTtcclxud2luZG93LnBsYXllclN0YXRlID0ge1xyXG4gICAgY3VycmVudExldmVsOiAnR2FtZSdcclxufVxyXG5cclxuZ2FtZS5zdGF0ZS5hZGQoJ0Jvb3QnLCByZXF1aXJlKCcuL3N0YXRlcy9ib290JykpO1xyXG4vL2dhbWUuc3RhdGUuYWRkKCdTcGxhc2gnLCByZXF1aXJlKCcuL3N0YXRlcy9zcGxhc2gnKSk7XHJcbmdhbWUuc3RhdGUuYWRkKCdQcmVsb2FkZXInLCByZXF1aXJlKCcuL3N0YXRlcy9wcmVsb2FkZXInKSk7XHJcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcclxuZ2FtZS5zdGF0ZS5hZGQoJ0dhbWVPdmVyJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZW92ZXInKSk7XHJcbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZScpKTtcclxuXHJcbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcclxuIiwidmFyIEVuZW15ID0gZnVuY3Rpb24gKGdhbWUsIHgsIHkpIHtcclxuXHJcbiAgICBQaGFzZXIuU3ByaXRlLmNhbGwodGhpcywgZ2FtZSwgeCwgeSwgJ2VuZW15U3ByaXRlJyk7XHJcblx0XHRnYW1lLmFkZC5leGlzdGluZyh0aGlzKTtcclxuXHRcdHRoaXMuYW5pbWF0aW9ucy5hZGQoJ3J1bicpO1xyXG5cdFx0dGhpcy5hbmltYXRpb25zLnBsYXkoJ3J1bicsIDI1LCB0cnVlKTtcclxufVxyXG5cclxuRW5lbXkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XHJcbkVuZW15LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEVuZW15O1xyXG5cclxuLyoqXHJcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxyXG4gKi9cclxuRW5lbXkucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG5cdHRoaXMubW92ZSgpO1xyXG5cclxufTtcclxuXHJcbkVuZW15LnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24oKSB7XHJcblx0dGhpcy55ICs9IDEuNztcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRW5lbXk7XHJcbiIsInZhciBCb290ID0gZnVuY3Rpb24gKCkge307XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3Q7XHJcblxyXG5Cb290LnByb3RvdHlwZSA9IHtcclxuXHJcbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcclxuICB9LFxyXG5cclxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcclxuICAgIC8vdGhpcy5nYW1lLmlucHV0Lm1heFBvaW50ZXJzID0gMTtcclxuXHJcbiAgICB0aGlzLmlucHV0Lm1heFBvaW50ZXJzID0gMTtcclxuICAgIHRoaXMuc3RhZ2UuZGlzYWJsZVZpc2liaWxpdHlDaGFuZ2UgPSB0cnVlO1xyXG5cclxuICAgIGlmICh0aGlzLmdhbWUuZGV2aWNlLmRlc2t0b3ApXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xyXG4gICAgICAgIHRoaXMuc2NhbGUuc2V0TWluTWF4KDQ4MCwgMjYwLCAxMDI0LCA3NjgpO1xyXG4gICAgICAgIHRoaXMuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnNjYWxlLnBhZ2VBbGlnblZlcnRpY2FsbHkgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2NhbGUuc2V0U2NyZWVuU2l6ZSh0cnVlKTtcclxuICAgICAgICB0aGlzLnNjYWxlLnJlZnJlc2goKTtcclxuICAgIH1cclxuICAgIGVsc2VcclxuICAgIHtcclxuICAgICAgICB0aGlzLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5zZXRNaW5NYXgoNDgwLCAyNjAsIDEwMjQsIDc2OCk7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2NhbGUucGFnZUFsaWduVmVydGljYWxseSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5mb3JjZU9yaWVudGF0aW9uKHRydWUsIGZhbHNlKTtcclxuICAgICAgICB0aGlzLnNjYWxlLnNldFJlc2l6ZUNhbGxiYWNrKHRoaXMuZ2FtZVJlc2l6ZWQsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuc2NhbGUuZW50ZXJJbmNvcnJlY3RPcmllbnRhdGlvbi5hZGQodGhpcy5lbnRlckluY29ycmVjdE9yaWVudGF0aW9uLCB0aGlzKTtcclxuICAgICAgICB0aGlzLnNjYWxlLmxlYXZlSW5jb3JyZWN0T3JpZW50YXRpb24uYWRkKHRoaXMubGVhdmVJbmNvcnJlY3RPcmllbnRhdGlvbiwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xyXG4gICAgICAgIHRoaXMuc2NhbGUucmVmcmVzaCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnUHJlbG9hZGVyJyk7XHJcbiAgfSxcclxuXHJcbiAgZ2FtZVJlc2l6ZWQ6IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7XHJcblxyXG4gICAgICAgIC8vICBUaGlzIGNvdWxkIGJlIGhhbmR5IGlmIHlvdSBuZWVkIHRvIGRvIGFueSBleHRyYSBwcm9jZXNzaW5nIGlmIHRoZSBnYW1lIHJlc2l6ZXMuXHJcbiAgICAgICAgLy8gIEEgcmVzaXplIGNvdWxkIGhhcHBlbiBpZiBmb3IgZXhhbXBsZSBzd2FwcGluZyBvcmllbnRhdGlvbiBvbiBhIGRldmljZSBvciByZXNpemluZyB0aGUgYnJvd3NlciB3aW5kb3cuXHJcbiAgICAgICAgLy8gIE5vdGUgdGhhdCB0aGlzIGNhbGxiYWNrIGlzIG9ubHkgcmVhbGx5IHVzZWZ1bCBpZiB5b3UgdXNlIGEgU2NhbGVNb2RlIG9mIFJFU0laRSBhbmQgcGxhY2UgaXQgaW5zaWRlIHlvdXIgbWFpbiBnYW1lIHN0YXRlLlxyXG5cclxuICAgIH0sXHJcblxyXG4gICAgZW50ZXJJbmNvcnJlY3RPcmllbnRhdGlvbjogZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICBCYXNpY0dhbWUub3JpZW50YXRlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3JpZW50YXRpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuXHJcbiAgICB9LFxyXG5cclxuICAgIGxlYXZlSW5jb3JyZWN0T3JpZW50YXRpb246IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgQmFzaWNHYW1lLm9yaWVudGF0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3JpZW50YXRpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG5cclxuICAgIH1cclxufTtcclxuIiwidmFyIEVuZW15ID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvZW5lbXknKTtcclxuXHJcbnZhciBHYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gIHRoaXMudGVzdGVudGl0eSA9IG51bGw7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XHJcblxyXG5HYW1lLnByb3RvdHlwZSA9IHtcclxuXHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmdyYXNzVGlsZVNwcml0ZSA9IHRoaXMuZ2FtZS5hZGQudGlsZVNwcml0ZSgwLCAwLCB0aGlzLmdhbWUud2lkdGgsIHRoaXMuZ2FtZS5oZWlnaHQsICdkYXJrX2dyYXNzJyk7XHJcbiAgICB0aGlzLnNhbmRUaWxlc3ByaXRlID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIHRoaXMuZ2FtZS5oZWlnaHQgLSA3MCwgdGhpcy5nYW1lLndpZHRoLCA1MCwgJ2VhcnRoJyk7XHJcblxyXG4gICAgdGhpcy5lbmVteXNTb2xkaWVycyA9IFtdO1xyXG4gICAgdGhpcy5zb2xkaWVycyA9IFtdO1xyXG4gICAgdGhpcy5lbmVteVNvbGRpZXJzQ291bnQgPSA1O1xyXG4gICAgdGhpcy5zb2xkaWVyc0NvdW50ID0gMTA7XHJcbiAgICB0aGlzLmdhbWVvdmVyID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5zb2xkaWVyc0xlZnRUZXh0ID0gdGhpcy5hZGQuYml0bWFwVGV4dCgwLCAyMCwgJ21pbmVjcmFmdGlhJywgdGhpcy5zb2xkaWVyc0NvdW50LnRvU3RyaW5nKCkgKTtcclxuICAgIHRoaXMuc29sZGllcnNMZWZ0VGV4dC54ID0gdGhpcy5nYW1lLndpZHRoIC0gdGhpcy5zb2xkaWVyc0xlZnRUZXh0LnRleHRXaWR0aCAtIDIwO1xyXG5cclxuICAgIC8vIEJ1bGxldHNcclxuICAgIHRoaXMuZmlyZVJhdGUgPSA1MDtcclxuICAgIHRoaXMubmV4dEZpcmUgPSAxMDtcclxuXHJcbiAgICB0aGlzLmJ1bGxldHMgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKCk7XHJcbiAgICB0aGlzLmJ1bGxldHMuZW5hYmxlQm9keSA9IHRydWU7XHJcbiAgICB0aGlzLmJ1bGxldHMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xyXG5cclxuICAgIHRoaXMuYnVsbGV0cy5jcmVhdGVNdWx0aXBsZSgxMDAsICdidWxsZXQnKTtcclxuICAgIHRoaXMuYnVsbGV0cy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcclxuICAgIHRoaXMuYnVsbGV0cy5zZXRBbGwoJ291dE9mQm91bmRzS2lsbCcsIHRydWUpO1xyXG5cclxuICAgIHRoaXMuc3ByaXRlID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUodGhpcy5nYW1lLndpZHRoIC8gMiwgdGhpcy5nYW1lLmhlaWdodCAtIDcwLCAndHVycmV0Jyk7XHJcbiAgICB0aGlzLnNwcml0ZS5hbmNob3Iuc2V0KDAuNSk7XHJcblxyXG4gICAgdGhpcy5nYW1lLnBoeXNpY3MuZW5hYmxlKHRoaXMuc3ByaXRlLCBQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xyXG5cclxuICAgIHRoaXMuc3ByaXRlLmJvZHkuYWxsb3dSb3RhdGlvbiA9IGZhbHNlO1xyXG5cclxuICAgIC8vIEVuZW15IGFuaW1hdGlvbnMgXHJcbiAgICB0aGlzLmVuZW15RHlpbmdBbmltYXRpb25zID0gdGhpcy5nYW1lLmFkZC5ncm91cCgpO1xyXG5cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNTAwOyBpKyspXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIGVuZW15RHlpbmdBbmltYXRpb24gPSB0aGlzLmVuZW15RHlpbmdBbmltYXRpb25zLmNyZWF0ZSgwLCAwLCAnZW5lbXlkeWluZycsIFswXSwgZmFsc2UpO1xyXG4gICAgICAgIGVuZW15RHlpbmdBbmltYXRpb24uYW5jaG9yLnNldFRvKDAsIC0wLjI1KTtcclxuICAgICAgICBlbmVteUR5aW5nQW5pbWF0aW9uLmFuaW1hdGlvbnMuYWRkKCdlbmVteWR5aW5nJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY29uY2VudHJhdGVkRmlyZVxyXG4gICAgdGhpcy5leHBsb3Npb25zID0gdGhpcy5nYW1lLmFkZC5ncm91cCgpO1xyXG4gICAgdGhpcy5leHBsb3Npb25zLmVuYWJsZUJvZHkgPSB0cnVlO1xyXG4gICAgdGhpcy5leHBsb3Npb25zLnBoeXNpY3NCb2R5VHlwZSA9IFBoYXNlci5QaHlzaWNzLkFSQ0FERTtcclxuICAgIGZvciAodmFyIGogPSAwOyBqIDwgMTA7IGorKylcclxuICAgIHtcclxuICAgICAgICB2YXIgZXhwbG9zaW9uQW5pbWF0aW9uID0gdGhpcy5leHBsb3Npb25zLmNyZWF0ZSgwLCAwLCAnc21hbGxFeHBsb3Npb24nLCBbMF0sIGZhbHNlKTtcclxuICAgICAgICBleHBsb3Npb25BbmltYXRpb24uYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcclxuICAgICAgICBleHBsb3Npb25BbmltYXRpb24uYW5pbWF0aW9ucy5hZGQoJ3NtYWxsRXhwbG9zaW9uJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyp0aGlzLmJvdCA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKDEwMCwgMTAwLCAnZW5lbXlTcHJpdGUnKTtcclxuICAgIHRoaXMuYm90LmFuaW1hdGlvbnMuYWRkKCdydW4nKTtcclxuICAgIHRoaXMuYm90LmFuaW1hdGlvbnMucGxheSgncnVuJywgMjUsIHRydWUpOyovXHJcblxyXG4gICAgdGhpcy5jb25jZW50cmF0ZWRGaXJlQnV0dG9uID0gdGhpcy5nYW1lLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuU1BBQ0VCQVIpO1xyXG5cclxuICB9LFxyXG5cclxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICBpZih0aGlzLmdhbWVvdmVyKSByZXR1cm47XHJcblxyXG4gICAgaWYodGhpcy5lbmVteXNTb2xkaWVycy5sZW5ndGggPCB0aGlzLmVuZW15U29sZGllcnNDb3VudCl7XHJcbiAgICAgIHRoaXMuY3JlYXRlRW5lbXkoKTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKHZhciBpID0gdGhpcy5lbmVteXNTb2xkaWVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICB2YXIgZW5lbXkgPSB0aGlzLmVuZW15c1NvbGRpZXJzW2ldO1xyXG5cclxuICAgICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAodGhpcy5idWxsZXRzLCB0aGlzLmVuZW15c1NvbGRpZXJzW2ldLCB0aGlzLmJ1bGxldEhpdEVuZW15LCBudWxsLCB0aGlzKTtcclxuICAgICAgXHJcbiAgICAgIC8vdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAodGhpcy5leHBsb3Npb25zLCB0aGlzLmVuZW15c1NvbGRpZXJzW2ldLCB0aGlzLmhpdEVuZW15LCBudWxsLCB0aGlzKTtcclxuXHJcblxyXG4gICAgICAvL3RoaXMuZW5lbXlzU29sZGllcnNbaV0udXBkYXRlKCk7XHJcbiAgICAgIGlmKGVuZW15LnkgPj0gdGhpcy5nYW1lLmhlaWdodCAtIDcwKSB7XHJcbiAgICAgICAgdGhpcy5zb2xkaWVyc0NvdW50IC09IDE7XHJcbiAgICAgICAgZW5lbXkuZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMuZW5lbXlzU29sZGllcnMuc3BsaWNlKGksMSk7XHJcbiAgICAgICAgdGhpcy5zb2xkaWVyc0xlZnRUZXh0LnNldFRleHQodGhpcy5zb2xkaWVyc0NvdW50LnRvU3RyaW5nKCkpO1xyXG5cclxuICAgICAgICBcclxuICAgICAgICB2YXIgZW5lbXlEeWluZ0FuaW1hdGlvbiA9IHRoaXMuZW5lbXlEeWluZ0FuaW1hdGlvbnMuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpO1xyXG4gICAgICAgIGVuZW15RHlpbmdBbmltYXRpb24ucmVzZXQoZW5lbXkueCwgZW5lbXkueSk7XHJcbiAgICAgICAgLy9lbmVteUR5aW5nQW5pbWF0aW9uLnBsYXkoJ2thYm9vbScsIDMwLCBmYWxzZSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuc29sZGllcnNDb3VudCA8PSAwKXtcclxuICAgICAgICAgIC8vY29uc29sZS5sb2coXCJQRUxJIExPUFBVIVwiKTtcclxuICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnR2FtZU92ZXInKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zcHJpdGUucm90YXRpb24gPSB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUuYW5nbGVUb1BvaW50ZXIodGhpcy5zcHJpdGUpO1xyXG4gICAgaWYgKHRoaXMuZ2FtZS5pbnB1dC5hY3RpdmVQb2ludGVyLmlzRG93bilcclxuICAgIHtcclxuICAgICAgdGhpcy5maXJlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuY29uY2VudHJhdGVkRmlyZUJ1dHRvbi5pc0Rvd24pIHtcclxuICAgICAgIHRoaXMuY29uY2VudHJhdGVkRmlyZSh0aGlzLmdhbWUuaW5wdXQuYWN0aXZlUG9pbnRlci54IC0gMTAwLHRoaXMuZ2FtZS5pbnB1dC5hY3RpdmVQb2ludGVyLnkgLSAxMDApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vdGhpcy5nYW1lLmRlYnVnLnNwcml0ZUJvdW5kcyh0aGlzLmV4cGxvc2lvbnMpO1xyXG4gICAgLy90aGlzLmdhbWUuZGVidWcuc3ByaXRlQ29ybmVycyh0aGlzLmV4cGxvc2lvbnMsIHRydWUsIHRydWUpO1xyXG5cclxuICB9LFxyXG5cclxuICBmaXJlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAodGhpcy5nYW1lLnRpbWUubm93ID4gdGhpcy5uZXh0RmlyZSAmJiB0aGlzLmJ1bGxldHMuY291bnREZWFkKCkgPiAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5uZXh0RmlyZSA9IHRoaXMuZ2FtZS50aW1lLm5vdyArIHRoaXMuZmlyZVJhdGU7XHJcblxyXG4gICAgICAgICAgICB2YXIgYnVsbGV0ID0gdGhpcy5idWxsZXRzLmdldEZpcnN0RGVhZCgpO1xyXG5cclxuICAgICAgICAgICAgYnVsbGV0LnJlc2V0KHRoaXMuc3ByaXRlLnggLSA4LCB0aGlzLnNwcml0ZS55IC0gOCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUubW92ZVRvUG9pbnRlcihidWxsZXQsIDE1MDApO1xyXG4gICAgICAgICAgICBidWxsZXQucm90YXRpb24gPSB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUubW92ZVRvUG9pbnRlcihidWxsZXQsIDI1MDAsIHRoaXMuZ2FtZS5pbnB1dC5hY3RpdmVQb2ludGVyLCA0MDApO1xyXG4gICAgICAgIH1cclxuICB9LFxyXG5cclxuICBjb25jZW50cmF0ZWRGaXJlOiBmdW5jdGlvbiAoeCx5KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5leHBsb3Npb25zLngpO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5leHBsb3Npb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICB2YXIgZXhwbG9zaW9uc0FuaW1hdGlvbiA9IHRoaXMuZXhwbG9zaW9ucy5nZXRBdChpKTtcclxuICAgICAgICAgIGV4cGxvc2lvbnNBbmltYXRpb24ucmVzZXQoeCArIE1hdGgucmFuZG9tKCkqMjAwLCB5ICsgTWF0aC5yYW5kb20oKSoyMDApO1xyXG4gICAgICAgICAgLy9lbmVteUR5aW5nQW5pbWF0aW9uLnJlc2V0KHgsIHkpO1xyXG4gICAgICAgICAgZXhwbG9zaW9uc0FuaW1hdGlvbi5wbGF5KCdzbWFsbEV4cGxvc2lvbicsIDMwLCBmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhleHBsb3Npb25zQW5pbWF0aW9uLngpO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coZXhwbG9zaW9uc0FuaW1hdGlvbi55KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAodmFyIGogPSB0aGlzLmVuZW15c1NvbGRpZXJzLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7XHJcbiAgICAgICAgICB2YXIgZW5lbXkgPSB0aGlzLmVuZW15c1NvbGRpZXJzW2pdO1xyXG4gXHJcbiAgICAgICAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUub3ZlcmxhcCh0aGlzLmV4cGxvc2lvbnMsIGVuZW15LCB0aGlzLmhpdEVuZW15LCBudWxsLCB0aGlzKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICB9LFxyXG5cclxuICBidWxsZXRIaXRFbmVteTogZnVuY3Rpb24gKGVuZW15LCBidWxsZXQpIHtcclxuICAgICAgYnVsbGV0LmtpbGwoKTtcclxuXHJcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLmVuZW15c1NvbGRpZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgaWYoZW5lbXkgPT09IHRoaXMuZW5lbXlzU29sZGllcnNbaV0pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdGhpcy5lbmVteXNTb2xkaWVycy5zcGxpY2UoaSwxKTtcclxuXHJcbiAgICAgICAgICB2YXIgZW5lbXlEeWluZ0FuaW1hdGlvbiA9IHRoaXMuZW5lbXlEeWluZ0FuaW1hdGlvbnMuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpO1xyXG4gICAgICAgICAgZW5lbXlEeWluZ0FuaW1hdGlvbi5yZXNldChlbmVteS54LCBlbmVteS55KTtcclxuICAgICAgICAgIGVuZW15RHlpbmdBbmltYXRpb24ucGxheSgnZW5lbXlkeWluZycsIDMwLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgICAgdGhpcy5nYW1lLnRpbWUuZXZlbnRzLmFkZChQaGFzZXIuVGltZXIuU0VDT05EICogMSwgdGhpcy5raWxsQW5pbWF0aW9uLCB0aGlzLCBlbmVteUR5aW5nQW5pbWF0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGVuZW15LmtpbGwoKTtcclxuXHJcbiAgICAgIC8vdmFyIGRlc3Ryb3llZCA9IGVuZW1pZXNbdGFuay5uYW1lXS5kYW1hZ2UoKTtcclxuXHJcbiAgICAgIC8qaWYgKGRlc3Ryb3llZClcclxuICAgICAge1xyXG4gICAgICAgICAgdmFyIGV4cGxvc2lvbkFuaW1hdGlvbiA9IGV4cGxvc2lvbnMuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpO1xyXG4gICAgICAgICAgZXhwbG9zaW9uQW5pbWF0aW9uLnJlc2V0KHRhbmsueCwgdGFuay55KTtcclxuICAgICAgICAgIGV4cGxvc2lvbkFuaW1hdGlvbi5wbGF5KCdrYWJvb20nLCAzMCwgZmFsc2UsIHRydWUpO1xyXG4gICAgICB9Ki9cclxuICB9LFxyXG5cclxuICBraWxsQW5pbWF0aW9uOiBmdW5jdGlvbiAoYW5pbWF0aW9uKSB7XHJcbiAgICBjb25zb2xlLmxvZygnZW5lbXlEeWluZ0FuaW1hdGlvbicpO1xyXG4gICAgdGhpcy5nYW1lLmFkZC50d2VlbihhbmltYXRpb24pLnRvKCB7IGFscGhhOiAwIH0sIDEwMDAsIFBoYXNlci5FYXNpbmcuTGluZWFyLk5vbmUsIHRydWUpO1xyXG4gIH0sXHJcblxyXG4gIGhpdEVuZW15OiBmdW5jdGlvbiAoZW5lbXkpIHtcclxuICAgIC8vY29uc29sZS5sb2coJ0hJVCEnKTtcclxuICAgIGZvciAodmFyIGkgPSB0aGlzLmVuZW15c1NvbGRpZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgIGlmKGVuZW15ID09PSB0aGlzLmVuZW15c1NvbGRpZXJzW2ldKVxyXG4gICAgICB7XHJcbiAgICAgICAgdGhpcy5lbmVteXNTb2xkaWVycy5zcGxpY2UoaSwxKTtcclxuXHJcbiAgICAgICAgdmFyIGVuZW15RHlpbmdBbmltYXRpb24gPSB0aGlzLmVuZW15RHlpbmdBbmltYXRpb25zLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcclxuICAgICAgICBlbmVteUR5aW5nQW5pbWF0aW9uLnJlc2V0KGVuZW15LngsIGVuZW15LnkpO1xyXG4gICAgICAgIGVuZW15RHlpbmdBbmltYXRpb24ucGxheSgnZW5lbXlkeWluZycsIDMwLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbmVteS5raWxsKCk7XHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlRW5lbXk6IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBlbmVteSA9IG5ldyBFbmVteSh0aGlzLmdhbWUsIHRoaXMuZ2FtZS53b3JsZC5yYW5kb21YLCAwKTtcclxuICAgIHRoaXMuZ2FtZS5waHlzaWNzLmVuYWJsZShlbmVteSwgUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcclxuICAgIHRoaXMuZW5lbXlzU29sZGllcnMucHVzaChlbmVteSk7XHJcbiAgICBcclxuICB9LFxyXG5cclxuICBjaGVja092ZXJsYXA6IGZ1bmN0aW9uIChzcHJpdGVBLCBzcHJpdGVCKSB7XHJcbiAgICB2YXIgYm91bmRzQSA9IHNwcml0ZUEuZ2V0Qm91bmRzKCk7XHJcbiAgICB2YXIgYm91bmRzQiA9IHNwcml0ZUIuZ2V0Qm91bmRzKCk7XHJcblxyXG4gICAgcmV0dXJuIFBoYXNlci5SZWN0YW5nbGUuaW50ZXJzZWN0cyhib3VuZHNBLCBib3VuZHNCKTtcclxuICB9LFxyXG5cclxuICBlbmRHYW1lOiBmdW5jdGlvbiAoKSB7XHJcbiAgICBcclxuICB9LFxyXG5cclxuICBvbklucHV0RG93bjogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XHJcbiAgfVxyXG59O1xyXG4iLCJ2YXIgR2FtZW92ZXIgPSBmdW5jdGlvbiAoKSB7fTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gR2FtZW92ZXI7XHJcblxyXG5HYW1lb3Zlci5wcm90b3R5cGUgPSB7XHJcblxyXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyXHJcbiAgICAgICwgeSA9IHRoaXMuZ2FtZS5oZWlnaHQgLyAyO1xyXG5cclxuICAgIHRoaXMudGl0bGVUeHQgPSB0aGlzLmFkZC5iaXRtYXBUZXh0KHgsIHksICdtaW5lY3JhZnRpYScsICdLaWxsZWQ6ICcgKTtcclxuICAgIHRoaXMudGl0bGVUeHQuYWxpZ24gPSAnY2VudGVyJztcclxuICAgIHRoaXMudGl0bGVUeHQueCA9IHRoaXMuZ2FtZS53aWR0aCAvIDIgLSB0aGlzLnRpdGxlVHh0LnRleHRXaWR0aCAvIDI7XHJcblxyXG4gICAgeSA9IHkgKyB0aGlzLnRpdGxlVHh0LmhlaWdodCArIDU7XHJcbiAgICB0aGlzLnN0YXJ0VHh0ID0gdGhpcy5hZGQuYml0bWFwVGV4dCh4LCB5LCAnbWluZWNyYWZ0aWEnLCAnR0FNRSBPVkVSJyk7XHJcbiAgICB0aGlzLnN0YXJ0VHh0LmFsaWduID0gJ2NlbnRlcic7XHJcbiAgICB0aGlzLnN0YXJ0VHh0LnggPSB0aGlzLmdhbWUud2lkdGggLyAyIC0gdGhpcy5zdGFydFR4dC50ZXh0V2lkdGggLyAyO1xyXG4gICAgXHJcbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xyXG4gIH0sXHJcblxyXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xyXG5cclxuICB9LFxyXG5cclxuICBvbkRvd246IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xyXG4gICAgLy90aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ0dhbWVvdmVyJyk7XHJcbiAgfVxyXG59O1xyXG4iLCJ2YXIgTWVudSA9IGZ1bmN0aW9uICgpIHtcclxuICB0aGlzLnRleHQgPSBudWxsO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xyXG5cclxuTWVudS5wcm90b3R5cGUgPSB7XHJcblxyXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyXHJcbiAgICAgICwgeSA9IHRoaXMuZ2FtZS5oZWlnaHQgLyAyO1xyXG5cclxuICAgIHRoaXMudGl0bGVUeHQgPSB0aGlzLmFkZC5iaXRtYXBUZXh0KHgsIHksICdtaW5lY3JhZnRpYScsICdOYWFwdXJpbmthdWh1JyApO1xyXG4gICAgdGhpcy50aXRsZVR4dC5hbGlnbiA9ICdjZW50ZXInO1xyXG4gICAgdGhpcy50aXRsZVR4dC54ID0gdGhpcy5nYW1lLndpZHRoIC8gMiAtIHRoaXMudGl0bGVUeHQudGV4dFdpZHRoIC8gMjtcclxuXHJcbiAgICB0aGlzLnN0YXJ0VHh0ID0gdGhpcy5hZGQuYml0bWFwVGV4dCh4LCB5ICsgdGhpcy50aXRsZVR4dC5oZWlnaHQgKyA1LCAnbWluZWNyYWZ0aWEnLCAnUHJlc3Mgc2NyZWVuIHRvIHN0YXJ0Jyk7XHJcbiAgICB0aGlzLnN0YXJ0VHh0LmFsaWduID0gJ2NlbnRlcic7XHJcbiAgICB0aGlzLnN0YXJ0VHh0LnggPSB0aGlzLmdhbWUud2lkdGggLyAyIC0gdGhpcy5zdGFydFR4dC50ZXh0V2lkdGggLyAyO1xyXG5cclxuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uRG93biwgdGhpcyk7XHJcbiAgfSxcclxuXHJcbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIG9uRG93bjogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdHYW1lJyk7XHJcbiAgICAvL3RoaXMuZ2FtZS5zY2FsZS5zdGFydEZ1bGxTY3JlZW4oKTtcclxuICB9XHJcbn07XHJcbiIsInZhciBQcmVsb2FkZXIgPSBmdW5jdGlvbiAoZ2FtZSkge1xyXG4gIHRoaXMuYXNzZXQgPSBudWxsO1xyXG4gIHRoaXMucmVhZHkgPSBmYWxzZTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZGVyO1xyXG5cclxuUHJlbG9hZGVyLnByb3RvdHlwZSA9IHtcclxuXHJcbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSh0aGlzLmdhbWUud2lkdGggLyAyLCB0aGlzLmdhbWUuaGVpZ2h0IC8gMiwgJ3ByZWxvYWRlcicpO1xyXG4gICAgICB0aGlzLmFzc2V0LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XHJcblxyXG4gICAgICB0aGlzLmxvYWQub25Mb2FkQ29tcGxldGUuYWRkT25jZSh0aGlzLm9uTG9hZENvbXBsZXRlLCB0aGlzKTtcclxuICAgICAgdGhpcy5sb2FkLnNldFByZWxvYWRTcHJpdGUodGhpcy5hc3NldCk7XHJcbiAgICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldCgna2Fib29tJywgJ2Fzc2V0cy9leHBsb3Npb24ucG5nJywgNjQsIDY0LCAyMyk7XHJcbiAgICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldCgnYmlnRXhwbG9zaW9uJywgJ2Fzc2V0cy9iaWctZXhwbG9zaW9uLnBuZycsIDI1NiwgMTI4LCAxMik7XHJcbiAgICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldCgnc21hbGxFeHBsb3Npb24nLCAnYXNzZXRzL3NtYWxsLWV4cGxvc2lvbi5wbmcnLCA5NiwgOTYsIDQ4KTtcclxuICAgICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdlbmVteWR5aW5nJywgJ2Fzc2V0cy9lbmVteWR5aW5nLnBuZycsIDYzLCA2NCwgMjApO1xyXG4gICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ2VuZW15U3ByaXRlJywgJ2Fzc2V0cy9lbmVteS5wbmcnLCA2NCwgNjQsIDE1KTtcclxuICAgICAgdGhpcy5sb2FkLmltYWdlKCdkYXJrX2dyYXNzJywgJ2Fzc2V0cy9kYXJrX2dyYXNzLnBuZycpO1xyXG4gICAgICB0aGlzLmxvYWQuaW1hZ2UoJ2VhcnRoJywgJ2Fzc2V0cy9lYXJ0aC5wbmcnKTtcclxuICAgICAgdGhpcy5sb2FkLmltYWdlKCdlbmVteScsICdhc3NldHMvaW52YWRlci5wbmcnKTtcclxuICAgICAgdGhpcy5sb2FkLmltYWdlKCd0dXJyZXQnLCAnYXNzZXRzL3R1cnJldC5wbmcnKTtcclxuICAgICAgdGhpcy5sb2FkLmltYWdlKCdidWxsZXQnLCAnYXNzZXRzL2J1bGxldC5wbmcnKTtcclxuICAgICAgdGhpcy5sb2FkLmJpdG1hcEZvbnQoJ21pbmVjcmFmdGlhJywgJ2Fzc2V0cy9taW5lY3JhZnRpYS5wbmcnLCAnYXNzZXRzL21pbmVjcmFmdGlhLnhtbCcpO1xyXG4gICAgICB0aGlzLmxvYWQuYXVkaW8oJ3NmeCcsICdhc3NldHMvYXVkaW8vU291bmRFZmZlY3RzL2Z4X21peGRvd24ub2dnJyk7XHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmFzc2V0LmNyb3BFbmFibGVkID0gZmFsc2U7XHJcbiAgfSxcclxuXHJcbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoISF0aGlzLnJlYWR5KSB7XHJcbiAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XHJcbiAgICAgIH1cclxuICB9LFxyXG5cclxuICBvbkxvYWRDb21wbGV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XHJcbiAgfVxyXG59O1xyXG4iLCJ2YXIgVXRpbHMgPSB7XHJcbiAgICBjb250YWluc09iamVjdDogZnVuY3Rpb24ob2JqLCBsaXN0KSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGxpc3RbaV0gPT09IG9iaikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gVXRpbHM7Il19
