(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(1024, 768, Phaser.AUTO, 'naapurinkauhu-game');

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game'
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('GameOver', require('./states/gameover'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\boot.js","./states/game":"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\game.js","./states/gameover":"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\gameover.js","./states/menu":"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\menu.js","./states/preloader":"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\preloader.js","./utils":"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\utils.js"}],"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\entities\\enemy.js":[function(require,module,exports){
var Enemy = function (game, x, y) {

    Phaser.Sprite.call(this, game, x, y, 'enemySprite');
		game.add.existing(this);
		this.animations.add('run');
		this.animations.play('run', 25, true);

		this.hitPoints = 1;
		this.width = 55;
		this.height = 55;

		this.healthBar = new Phaser.Rectangle(this.x, this.y, 30, 5);
		//game.debug.geom(this.healthBar,'#ff6600');
};

Enemy.prototype = Object.create(Phaser.Sprite.prototype);
Enemy.prototype.constructor = Enemy;

/**
 * Automatically called by World.update
 */
Enemy.prototype.update = function() {
	this.move();

	if(this.hitPoints < 5) {
		this.healthBar.x = this.x + this.width / 2 - 15;
		this.healthBar.y = this.y;
		this.healthBar.width = this.hitPoints * (30 / 5);
		this.game.debug.geom(this.healthBar,'#D71E1E');
	}
	
};

Enemy.prototype.move = function() {
	this.y += 1.7;
};

Enemy.prototype.hit = function() {
	this.hitPoints -= 1;
	this.bloodSpread();
};

Enemy.prototype.bloodSpread = function() {
	//console.log('SPLÃ„TS');

};

module.exports = Enemy;

},{}],"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    //this.game.input.maxPointers = 1;

    this.input.maxPointers = 1;
    this.stage.disableVisibilityChange = true;

    if (this.game.device.desktop)
    {
        this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
        this.scale.setMinMax(480, 260, 1024, 768);
        this.scale.pageAlignHorizontally = true;
        this.scale.pageAlignVertically = true;
        this.scale.setScreenSize(true);
        this.scale.refresh();
    }
    else
    {
        this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
        this.scale.setMinMax(480, 260, 1024, 768);
        this.scale.pageAlignHorizontally = true;
        this.scale.pageAlignVertically = true;
        this.scale.forceOrientation(true, false);
        this.scale.setResizeCallback(this.gameResized, this);
        this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation, this);
        this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation, this);
        this.scale.setScreenSize(true);
        this.scale.refresh();
    }

    this.game.state.start('Preloader');
  },

    gameResized: function (width, height) {

        //  This could be handy if you need to do any extra processing if the game resizes.
        //  A resize could happen if for example swapping orientation on a device or resizing the browser window.
        //  Note that this callback is only really useful if you use a ScaleMode of RESIZE and place it inside your main game state.

    },

    enterIncorrectOrientation: function () {

        BasicGame.orientated = false;

        document.getElementById('orientation').style.display = 'block';

    },

    leaveIncorrectOrientation: function () {

        BasicGame.orientated = true;

        document.getElementById('orientation').style.display = 'none';

    }
};

},{}],"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\game.js":[function(require,module,exports){
var Enemy = require('../entities/enemy');

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    //this.grassTileSprite = this.game.add.tileSprite(0, 0, this.game.width, this.game.height, 'dark_grass');
    //this.sandTilesprite = this.game.add.tileSprite(0, this.game.height - 128, this.game.width, 128, 'earth');

    this.levels = [{id:"Level 1", length:2, speed:2000} , {id:"Level 2", length:5, speed:1500} , {id:"Level 3", length:10, speed:1000} , {id:"Level 4", length:15, speed:300} , {id:"Level 5", length:30, speed:50}, {id:"Level 6", length:40, speed:10}];
    this.levelIndex = 0;
    this.levelLoading = true;

    this.backGround = this.game.add.sprite(0,0, 'bg');

    this.game.time.advancedTiming = true;

    this.enemysSoldiers = [];
    this.soldiers = [];
    this.enemySoldiersCount = 10;
    this.soldiersCount = 10;
    this.gameover = false;
    this.game.enemyKilled = 0;

    this.soldiersLeftText = this.add.bitmapText(0, 60, 'minecraftia', this.soldiersCount.toString() );
    this.soldiersLeftText.x = this.game.width - this.soldiersLeftText.textWidth - 20;

    this.currentLevelText = this.add.bitmapText(0, 20, 'minecraftia', this.currentLevel().id );
    this.currentLevelText.x = this.game.width - this.currentLevelText.textWidth - 20;

    // Bullets
    this.fireRate = 50;
    this.nextFire = 10;

    this.bullets = this.game.add.group();
    this.bullets.enableBody = true;
    this.bullets.physicsBodyType = Phaser.Physics.ARCADE;

    this.bullets.createMultiple(100, 'bullet');
    this.bullets.setAll('checkWorldBounds', true);
    this.bullets.setAll('outOfBoundsKill', true);

    //this.turretHolder = this.game.add.sprite(this.game.width / 2, this.game.height - 75, 'turretholder');
    
    this.sprite = this.game.add.sprite(this.game.width / 2 - 20, this.game.height - 75, 'turret');
    this.sprite.scale.set(0.25,0.25);
    this.sprite.anchor.set(0, 0.5);
    this.sprite.visible = false;

    this.game.physics.enable(this.sprite, Phaser.Physics.ARCADE);
    this.sprite.body.allowRotation = false;

    this.enemyTimer = this.game.time.create(false);
    this.enemyTimer.loop(this.currentLevel().speed, this.createEnemy, this);
    this.enemyTimer.start();

    // Enemy animations 
    this.enemyDyingAnimations = this.game.add.group();

    for (var i = 0; i < 30; i++)
    {
        var enemyDyingAnimation = this.enemyDyingAnimations.create(0, 0, 'enemydying', [0], false);
        enemyDyingAnimation.anchor.setTo(0, -0.25);
        enemyDyingAnimation.animations.add('enemydying');
    }

    // concentratedFire
    this.explosions = this.game.add.group();
    //this.explosions.enableBody = true;
    //this.explosions.physicsBodyType = Phaser.Physics.ARCADE;
    for (var j = 0; j < 10; j++)
    {
        var explosionAnimation = this.explosions.create(0, 0, 'smallExplosion', [0], false);
        explosionAnimation.anchor.setTo(0.5, 0.5);
        explosionAnimation.animations.add('smallExplosion');
    }

    //this.concentratedFireButton = this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

    //this.emitter = this.game.add.emitter(0, 0, 100);
    //this.emitter.particleFriction = 0.1;

  },

  update: function () {

    this.game.debug.text(this.game.time.fps || '--', 2, 14, '#00ff00');

    if(this.gameover) {
      return;
    }

    /*if(this.enemysSoldiers.length < this.enemySoldiersCount){
      this.createEnemy();
    }*/

    if(!this.enemysSoldiers) {
      return;
    }

    for (var i = this.enemysSoldiers.length - 1; i >= 0; i--) {
      var enemy = this.enemysSoldiers[i];

      this.game.physics.arcade.overlap(this.bullets, this.enemysSoldiers[i], this.bulletHitEnemy, null, this);
      
      if(enemy.y >= this.game.height - 150) {
        this.soldiersCount -= 1;
        
        this.enemysSoldiers.splice(i,1);
        this.soldiersLeftText.setText(this.soldiersCount.toString());

        var explosiong = this.explosions.getFirstExists(false);
        explosiong.reset(enemy.x, enemy.y);
        explosiong.play('smallExplosion', 30, false, false);

        enemy.destroy();

        if(this.soldiersCount <= 0){
          this.game.state.start('GameOver');
        }
      }

    }

    this.sprite.rotation = this.game.physics.arcade.angleToPointer(this.sprite);
    if (this.game.input.activePointer.isDown) {
      this.sprite.visible = true;
      this.fire();
    } else {
       this.sprite.visible = false;
    }

    /*if (this.concentratedFireButton.isDown) {
       this.concentratedFire(this.game.input.activePointer.x - 100,this.game.input.activePointer.y - 100);
    }*/

  },

  fire: function () {
    if (this.game.time.now > this.nextFire && this.bullets.countDead() > 0)
    {
      this.nextFire = this.game.time.now + this.fireRate;
      var bullet = this.bullets.getFirstDead();
      bullet.reset(this.sprite.x - 2, this.sprite.y - 5);
      bullet.rotation = this.game.physics.arcade.moveToPointer(bullet, 1500, this.game.input.activePointer);
    }
  },

  currentLevel: function () {
    return this.levels[this.levelIndex];
  },

  nextLevel: function () {
    this.levelIndex++;

    if(this.currentLevel()) {
      
      //this.enemyTimer.delay = this.currentLevel().speed;
      this.enemyTimer.destroy();
      this.enemyTimer = this.game.time.create(false);
      this.enemyTimer.loop(this.currentLevel().speed, this.createEnemy, this);
      this.enemyTimer.start();


      this.currentLevelText.destroy();
      this.currentLevelText = this.add.bitmapText(0, 20, 'minecraftia', this.currentLevel().id );
      this.currentLevelText.x = this.game.width - this.currentLevelText.textWidth - 20;


    } else {
      this.game.state.start('GameOver');
    }    
  },

  concentratedFire: function (x,y) {
        for (var i = this.explosions.length - 1; i >= 0; i--) {
          var explosionsAnimation = this.explosions.getAt(i);
          explosionsAnimation.reset(x + Math.random()*200, y + Math.random()*200);
          explosionsAnimation.play('smallExplosion', 30, false, true);
        }

        for (var j = this.enemysSoldiers.length - 1; j >= 0; j--) {
          var enemy = this.enemysSoldiers[j];
           this.game.physics.arcade.overlap(this.explosions, enemy, this.hitEnemy, null, this);
          
        }
  },

  bulletHitEnemy: function (enemy, bullet) {

      /*this.emitter.makeParticles('blood');
      var blood = new Phaser.Rectangle(0, 0, 30, 5);
      this.emitter.makeParticles(blood);

      this.emitter.rotation = bullet.rotation;

      this.emitter.gravity = 0;
      this.emitter.maxRotation = 0;
      this.emitter.minRotation = 0;

      this.emitter.setAlpha(1, 0, 600);

      var p1 = new Phaser.Point (1,0);
      p1.rotate(0,0,bullet.rotation + 0.5);
      p1.setMagnitude(200);
      
      var p2 = new Phaser.Point (1,0);
      p2.rotate(0,0,bullet.rotation - 0.5);
      p2.setMagnitude(200);

      this.emitter.maxParticleSpeed = p1;
      this.emitter.minParticleSpeed = p2;
      //this.emitter.rotation = 0;
      this.emitter.x = enemy.x + 30;
      this.emitter.y = enemy.y + 35;

      this.emitter.start(true, 600, null, 10);*/
      bullet.kill();

      for (var i = this.enemysSoldiers.length - 1; i >= 0; i--) {
        if(enemy === this.enemysSoldiers[i])
        {
          enemy.hit();

          if(enemy.hitPoints === 0) {
            this.enemysSoldiers.splice(i,1);

            var enemyDyingAnimation = this.enemyDyingAnimations.getFirstExists(false);
            enemyDyingAnimation.reset(enemy.x, enemy.y);
            enemyDyingAnimation.alpha = 1;
            enemyDyingAnimation.play('enemydying', 30, false, false);
            this.game.time.events.add(Phaser.Timer.SECOND * 1, this.fadeAnimation, this, enemyDyingAnimation);
          }
        }
      }
      
      if(enemy.hitPoints === 0) {
        enemy.kill();
        this.game.enemyKilled++;

        if(this.game.enemyKilled >= this.currentLevel().length){
          this.nextLevel();
        }
      }

      //var destroyed = enemies[tank.name].damage();

      /*if (destroyed)
      {
          var explosionAnimation = explosions.getFirstExists(false);
          explosionAnimation.reset(tank.x, tank.y);
          explosionAnimation.play('kaboom', 30, false, true);
      }*/
  },

  fadeAnimation: function (animation) {
    //console.log("-----");
    //console.log(animation);
    var fadeAnim = this.game.add.tween(animation).to( { alpha: 0 }, 1000, Phaser.Easing.Linear.None, true);
    fadeAnim.onComplete.add(function () { this.removeTween(animation); }, this);

  },

  hitEnemy: function (enemy) {
    for (var i = this.enemysSoldiers.length - 1; i >= 0; i--) {
      if(enemy === this.enemysSoldiers[i])
      {
        this.enemysSoldiers.splice(i,1);

        var enemyDyingAnimation = this.enemyDyingAnimations.getFirstExists(false);
        enemyDyingAnimation.reset(enemy.x, enemy.y);
        enemyDyingAnimation.play('enemydying', 30, false, false);
      }
    }
    enemy.kill();
  },

  removeTween: function (animation) {
    animation.kill();
  },
  killAnimation: function (animation) {
    //console.log("this.enemyDyingAnimations");
    //console.log(this.enemyDyingAnimations);
  },

  checkOverlapEnemyX: function () {
    
    

  },

  createEnemy: function () {

    var enemyX = Math.floor(Math.random() * (this.game.width - 65));

    /*var pass = true;
    for (var i = this.enemysSoldiers.length - 1; i >= 0; i--) {
      var soldier = this.enemysSoldiers[i];

      if(enemyX < soldier.x + 65 && enemyX > soldier.x - 65 ) {
        pass = false;
      }

    }*/

    /*if(!pass){
      this.createEnemy();
      return;
    }*/

    var enemy = new Enemy(this.game, enemyX, 0);
    this.game.physics.enable(enemy, Phaser.Physics.ARCADE);
    this.enemysSoldiers.push(enemy);
    
  },

  checkOverlap: function (spriteA, spriteB) {
    var boundsA = spriteA.getBounds();
    var boundsB = spriteB.getBounds();

    return Phaser.Rectangle.intersects(boundsA, boundsB);
  },

  endGame: function () {
    
  },

  onInputDown: function () {
    this.game.state.start('Menu');
  }
};

},{"../entities/enemy":"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\entities\\enemy.js"}],"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\gameover.js":[function(require,module,exports){
var Gameover = function () {};

module.exports = Gameover;

Gameover.prototype = {

  create: function () {
    var x = this.game.width / 2
      , y = this.game.height / 2;

    this.titleTxt = this.add.bitmapText(x, y, 'minecraftia', 'Killed: ' + this.game.enemyKilled );
    this.titleTxt.align = 'center';
    this.titleTxt.x = this.game.width / 2 - this.titleTxt.textWidth / 2;

    //y = y + this.titleTxt.height + 5;
    this.startTxt = this.add.bitmapText(x, y + 50, 'minecraftia', 'GAME OVER');
    this.startTxt.align = 'center';
    this.startTxt.x = this.game.width / 2 - this.startTxt.textWidth / 2;
    
    this.input.onDown.add(this.onDown, this);
  },

  update: function () {

  },

  onDown: function () {
    this.game.state.start('Menu');
    //this.game.state.start('Gameover');
  }
};

},{}],"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2
      , y = this.game.height / 2;

    
    this.logoText = this.add.bitmapText(x, y - 200, 'minecraftia', 'LSG', 164 );
    this.logoText.align = 'center';
    this.logoText.x = this.game.width / 2 - this.logoText.textWidth / 2;

    this.desciptionTxt = this.add.bitmapText(x, y + 10, 'minecraftia', 'LITTLE SHITTY GAMES', 27 );
    this.desciptionTxt.align = 'center';
    this.desciptionTxt.x = this.game.width / 2 - this.desciptionTxt.textWidth / 2;

    this.titleTxt = this.add.bitmapText(x, y + 100, 'minecraftia', 'Naapurinkauhu' );
    this.titleTxt.align = 'center';
    this.titleTxt.x = this.game.width / 2 - this.titleTxt.textWidth / 2;

    this.startTxt = this.add.bitmapText(x, this.game.height - this.titleTxt.height - 15, 'minecraftia', 'Press screen to start');
    this.startTxt.align = 'center';
    this.startTxt.x = this.game.width / 2 - this.startTxt.textWidth / 2;

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {

  },

  onDown: function () {
    this.game.state.start('Game');
    //this.game.scale.startFullScreen();
  }
};

},{}],"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\states\\preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
      this.asset = this.add.sprite(this.game.width / 2, this.game.height / 2, 'preloader');
      this.asset.anchor.setTo(0.5, 0.5);

      this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
      this.load.setPreloadSprite(this.asset);
      this.load.spritesheet('kaboom', 'assets/explosion.png', 64, 64, 23);
      this.load.spritesheet('bigExplosion', 'assets/big-explosion.png', 256, 128, 12);
      this.load.spritesheet('smallExplosion', 'assets/small-explosion.png', 96, 96, 48);
      this.load.spritesheet('enemydying', 'assets/enemydying.png', 63, 64, 20);
      this.load.spritesheet('enemySprite', 'assets/enemy.png', 64, 64, 15);
      this.load.image('bg', 'assets/bg.png');
      this.load.image('blood', 'assets/blood.jpg');
      this.load.image('earth', 'assets/earth.png');
      this.load.image('enemy', 'assets/invader.png');
      this.load.image('turret', 'assets/turret.png');
      this.load.image('turretholder', 'assets/gun-holder.png');
      this.load.image('bullet', 'assets/bullet.png');
      this.load.bitmapFont('minecraftia', 'assets/minecraftia.png', 'assets/minecraftia.xml');
      this.load.audio('sfx', 'assets/audio/SoundEffects/fx_mixdown.ogg');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
        this.game.state.start('Menu');
      }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],"D:\\PROJECTS\\GIT\\lsg-naapurin-kauhu-up\\src\\js\\utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["./src/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlc1xcYnJvd3NlcmlmeVxcbm9kZV9tb2R1bGVzXFxicm93c2VyLXBhY2tcXF9wcmVsdWRlLmpzIiwic3JjXFxqc1xcbWFpbi5qcyIsInNyY1xcanNcXGVudGl0aWVzXFxlbmVteS5qcyIsInNyY1xcanNcXHN0YXRlc1xcYm9vdC5qcyIsInNyY1xcanNcXHN0YXRlc1xcZ2FtZS5qcyIsInNyY1xcanNcXHN0YXRlc1xcZ2FtZW92ZXIuanMiLCJzcmNcXGpzXFxzdGF0ZXNcXG1lbnUuanMiLCJzcmNcXGpzXFxzdGF0ZXNcXHByZWxvYWRlci5qcyIsInNyY1xcanNcXHV0aWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZSgxMDI0LCA3NjgsIFBoYXNlci5BVVRPLCAnbmFhcHVyaW5rYXVodS1nYW1lJyk7XHJcblxyXG53aW5kb3cuVXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7XHJcbndpbmRvdy5wbGF5ZXJTdGF0ZSA9IHtcclxuICAgIGN1cnJlbnRMZXZlbDogJ0dhbWUnXHJcbn1cclxuXHJcbmdhbWUuc3RhdGUuYWRkKCdCb290JywgcmVxdWlyZSgnLi9zdGF0ZXMvYm9vdCcpKTtcclxuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcclxuZ2FtZS5zdGF0ZS5hZGQoJ01lbnUnLCByZXF1aXJlKCcuL3N0YXRlcy9tZW51JykpO1xyXG5nYW1lLnN0YXRlLmFkZCgnR2FtZU92ZXInLCByZXF1aXJlKCcuL3N0YXRlcy9nYW1lb3ZlcicpKTtcclxuZ2FtZS5zdGF0ZS5hZGQoJ0dhbWUnLCByZXF1aXJlKCcuL3N0YXRlcy9nYW1lJykpO1xyXG5cclxuZ2FtZS5zdGF0ZS5zdGFydCgnQm9vdCcpO1xyXG4iLCJ2YXIgRW5lbXkgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSkge1xyXG5cclxuICAgIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAnZW5lbXlTcHJpdGUnKTtcclxuXHRcdGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xyXG5cdFx0dGhpcy5hbmltYXRpb25zLmFkZCgncnVuJyk7XHJcblx0XHR0aGlzLmFuaW1hdGlvbnMucGxheSgncnVuJywgMjUsIHRydWUpO1xyXG5cclxuXHRcdHRoaXMuaGl0UG9pbnRzID0gMTtcclxuXHRcdHRoaXMud2lkdGggPSA1NTtcclxuXHRcdHRoaXMuaGVpZ2h0ID0gNTU7XHJcblxyXG5cdFx0dGhpcy5oZWFsdGhCYXIgPSBuZXcgUGhhc2VyLlJlY3RhbmdsZSh0aGlzLngsIHRoaXMueSwgMzAsIDUpO1xyXG5cdFx0Ly9nYW1lLmRlYnVnLmdlb20odGhpcy5oZWFsdGhCYXIsJyNmZjY2MDAnKTtcclxufTtcclxuXHJcbkVuZW15LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpO1xyXG5FbmVteS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBFbmVteTtcclxuXHJcbi8qKlxyXG4gKiBBdXRvbWF0aWNhbGx5IGNhbGxlZCBieSBXb3JsZC51cGRhdGVcclxuICovXHJcbkVuZW15LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcclxuXHR0aGlzLm1vdmUoKTtcclxuXHJcblx0aWYodGhpcy5oaXRQb2ludHMgPCA1KSB7XHJcblx0XHR0aGlzLmhlYWx0aEJhci54ID0gdGhpcy54ICsgdGhpcy53aWR0aCAvIDIgLSAxNTtcclxuXHRcdHRoaXMuaGVhbHRoQmFyLnkgPSB0aGlzLnk7XHJcblx0XHR0aGlzLmhlYWx0aEJhci53aWR0aCA9IHRoaXMuaGl0UG9pbnRzICogKDMwIC8gNSk7XHJcblx0XHR0aGlzLmdhbWUuZGVidWcuZ2VvbSh0aGlzLmhlYWx0aEJhciwnI0Q3MUUxRScpO1xyXG5cdH1cclxuXHRcclxufTtcclxuXHJcbkVuZW15LnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24oKSB7XHJcblx0dGhpcy55ICs9IDEuNztcclxufTtcclxuXHJcbkVuZW15LnByb3RvdHlwZS5oaXQgPSBmdW5jdGlvbigpIHtcclxuXHR0aGlzLmhpdFBvaW50cyAtPSAxO1xyXG5cdHRoaXMuYmxvb2RTcHJlYWQoKTtcclxufTtcclxuXHJcbkVuZW15LnByb3RvdHlwZS5ibG9vZFNwcmVhZCA9IGZ1bmN0aW9uKCkge1xyXG5cdC8vY29uc29sZS5sb2coJ1NQTMOEVFMnKTtcclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEVuZW15O1xyXG4iLCJ2YXIgQm9vdCA9IGZ1bmN0aW9uICgpIHt9O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xyXG5cclxuQm9vdC5wcm90b3R5cGUgPSB7XHJcblxyXG4gIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMubG9hZC5pbWFnZSgncHJlbG9hZGVyJywgJ2Fzc2V0cy9wcmVsb2FkZXIuZ2lmJyk7XHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAvL3RoaXMuZ2FtZS5pbnB1dC5tYXhQb2ludGVycyA9IDE7XHJcblxyXG4gICAgdGhpcy5pbnB1dC5tYXhQb2ludGVycyA9IDE7XHJcbiAgICB0aGlzLnN0YWdlLmRpc2FibGVWaXNpYmlsaXR5Q2hhbmdlID0gdHJ1ZTtcclxuXHJcbiAgICBpZiAodGhpcy5nYW1lLmRldmljZS5kZXNrdG9wKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuc2NhbGUuc2NhbGVNb2RlID0gUGhhc2VyLlNjYWxlTWFuYWdlci5TSE9XX0FMTDtcclxuICAgICAgICB0aGlzLnNjYWxlLnNldE1pbk1heCg0ODAsIDI2MCwgMTAyNCwgNzY4KTtcclxuICAgICAgICB0aGlzLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5wYWdlQWxpZ25WZXJ0aWNhbGx5ID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5yZWZyZXNoKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xyXG4gICAgICAgIHRoaXMuc2NhbGUuc2V0TWluTWF4KDQ4MCwgMjYwLCAxMDI0LCA3NjgpO1xyXG4gICAgICAgIHRoaXMuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnNjYWxlLnBhZ2VBbGlnblZlcnRpY2FsbHkgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2NhbGUuZm9yY2VPcmllbnRhdGlvbih0cnVlLCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5zZXRSZXNpemVDYWxsYmFjayh0aGlzLmdhbWVSZXNpemVkLCB0aGlzKTtcclxuICAgICAgICB0aGlzLnNjYWxlLmVudGVySW5jb3JyZWN0T3JpZW50YXRpb24uYWRkKHRoaXMuZW50ZXJJbmNvcnJlY3RPcmllbnRhdGlvbiwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5zY2FsZS5sZWF2ZUluY29ycmVjdE9yaWVudGF0aW9uLmFkZCh0aGlzLmxlYXZlSW5jb3JyZWN0T3JpZW50YXRpb24sIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuc2NhbGUuc2V0U2NyZWVuU2l6ZSh0cnVlKTtcclxuICAgICAgICB0aGlzLnNjYWxlLnJlZnJlc2goKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ1ByZWxvYWRlcicpO1xyXG4gIH0sXHJcblxyXG4gICAgZ2FtZVJlc2l6ZWQ6IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7XHJcblxyXG4gICAgICAgIC8vICBUaGlzIGNvdWxkIGJlIGhhbmR5IGlmIHlvdSBuZWVkIHRvIGRvIGFueSBleHRyYSBwcm9jZXNzaW5nIGlmIHRoZSBnYW1lIHJlc2l6ZXMuXHJcbiAgICAgICAgLy8gIEEgcmVzaXplIGNvdWxkIGhhcHBlbiBpZiBmb3IgZXhhbXBsZSBzd2FwcGluZyBvcmllbnRhdGlvbiBvbiBhIGRldmljZSBvciByZXNpemluZyB0aGUgYnJvd3NlciB3aW5kb3cuXHJcbiAgICAgICAgLy8gIE5vdGUgdGhhdCB0aGlzIGNhbGxiYWNrIGlzIG9ubHkgcmVhbGx5IHVzZWZ1bCBpZiB5b3UgdXNlIGEgU2NhbGVNb2RlIG9mIFJFU0laRSBhbmQgcGxhY2UgaXQgaW5zaWRlIHlvdXIgbWFpbiBnYW1lIHN0YXRlLlxyXG5cclxuICAgIH0sXHJcblxyXG4gICAgZW50ZXJJbmNvcnJlY3RPcmllbnRhdGlvbjogZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICBCYXNpY0dhbWUub3JpZW50YXRlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3JpZW50YXRpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuXHJcbiAgICB9LFxyXG5cclxuICAgIGxlYXZlSW5jb3JyZWN0T3JpZW50YXRpb246IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgQmFzaWNHYW1lLm9yaWVudGF0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3JpZW50YXRpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG5cclxuICAgIH1cclxufTtcclxuIiwidmFyIEVuZW15ID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvZW5lbXknKTtcclxuXHJcbnZhciBHYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gIHRoaXMudGVzdGVudGl0eSA9IG51bGw7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XHJcblxyXG5HYW1lLnByb3RvdHlwZSA9IHtcclxuXHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAvL3RoaXMuZ3Jhc3NUaWxlU3ByaXRlID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIDAsIHRoaXMuZ2FtZS53aWR0aCwgdGhpcy5nYW1lLmhlaWdodCwgJ2RhcmtfZ3Jhc3MnKTtcclxuICAgIC8vdGhpcy5zYW5kVGlsZXNwcml0ZSA9IHRoaXMuZ2FtZS5hZGQudGlsZVNwcml0ZSgwLCB0aGlzLmdhbWUuaGVpZ2h0IC0gMTI4LCB0aGlzLmdhbWUud2lkdGgsIDEyOCwgJ2VhcnRoJyk7XHJcblxyXG4gICAgdGhpcy5sZXZlbHMgPSBbe2lkOlwiTGV2ZWwgMVwiLCBsZW5ndGg6Miwgc3BlZWQ6MjAwMH0gLCB7aWQ6XCJMZXZlbCAyXCIsIGxlbmd0aDo1LCBzcGVlZDoxNTAwfSAsIHtpZDpcIkxldmVsIDNcIiwgbGVuZ3RoOjEwLCBzcGVlZDoxMDAwfSAsIHtpZDpcIkxldmVsIDRcIiwgbGVuZ3RoOjE1LCBzcGVlZDozMDB9ICwge2lkOlwiTGV2ZWwgNVwiLCBsZW5ndGg6MzAsIHNwZWVkOjUwfSwge2lkOlwiTGV2ZWwgNlwiLCBsZW5ndGg6NDAsIHNwZWVkOjEwfV07XHJcbiAgICB0aGlzLmxldmVsSW5kZXggPSAwO1xyXG4gICAgdGhpcy5sZXZlbExvYWRpbmcgPSB0cnVlO1xyXG5cclxuICAgIHRoaXMuYmFja0dyb3VuZCA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKDAsMCwgJ2JnJyk7XHJcblxyXG4gICAgdGhpcy5nYW1lLnRpbWUuYWR2YW5jZWRUaW1pbmcgPSB0cnVlO1xyXG5cclxuICAgIHRoaXMuZW5lbXlzU29sZGllcnMgPSBbXTtcclxuICAgIHRoaXMuc29sZGllcnMgPSBbXTtcclxuICAgIHRoaXMuZW5lbXlTb2xkaWVyc0NvdW50ID0gMTA7XHJcbiAgICB0aGlzLnNvbGRpZXJzQ291bnQgPSAxMDtcclxuICAgIHRoaXMuZ2FtZW92ZXIgPSBmYWxzZTtcclxuICAgIHRoaXMuZ2FtZS5lbmVteUtpbGxlZCA9IDA7XHJcblxyXG4gICAgdGhpcy5zb2xkaWVyc0xlZnRUZXh0ID0gdGhpcy5hZGQuYml0bWFwVGV4dCgwLCA2MCwgJ21pbmVjcmFmdGlhJywgdGhpcy5zb2xkaWVyc0NvdW50LnRvU3RyaW5nKCkgKTtcclxuICAgIHRoaXMuc29sZGllcnNMZWZ0VGV4dC54ID0gdGhpcy5nYW1lLndpZHRoIC0gdGhpcy5zb2xkaWVyc0xlZnRUZXh0LnRleHRXaWR0aCAtIDIwO1xyXG5cclxuICAgIHRoaXMuY3VycmVudExldmVsVGV4dCA9IHRoaXMuYWRkLmJpdG1hcFRleHQoMCwgMjAsICdtaW5lY3JhZnRpYScsIHRoaXMuY3VycmVudExldmVsKCkuaWQgKTtcclxuICAgIHRoaXMuY3VycmVudExldmVsVGV4dC54ID0gdGhpcy5nYW1lLndpZHRoIC0gdGhpcy5jdXJyZW50TGV2ZWxUZXh0LnRleHRXaWR0aCAtIDIwO1xyXG5cclxuICAgIC8vIEJ1bGxldHNcclxuICAgIHRoaXMuZmlyZVJhdGUgPSA1MDtcclxuICAgIHRoaXMubmV4dEZpcmUgPSAxMDtcclxuXHJcbiAgICB0aGlzLmJ1bGxldHMgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKCk7XHJcbiAgICB0aGlzLmJ1bGxldHMuZW5hYmxlQm9keSA9IHRydWU7XHJcbiAgICB0aGlzLmJ1bGxldHMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xyXG5cclxuICAgIHRoaXMuYnVsbGV0cy5jcmVhdGVNdWx0aXBsZSgxMDAsICdidWxsZXQnKTtcclxuICAgIHRoaXMuYnVsbGV0cy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcclxuICAgIHRoaXMuYnVsbGV0cy5zZXRBbGwoJ291dE9mQm91bmRzS2lsbCcsIHRydWUpO1xyXG5cclxuICAgIC8vdGhpcy50dXJyZXRIb2xkZXIgPSB0aGlzLmdhbWUuYWRkLnNwcml0ZSh0aGlzLmdhbWUud2lkdGggLyAyLCB0aGlzLmdhbWUuaGVpZ2h0IC0gNzUsICd0dXJyZXRob2xkZXInKTtcclxuICAgIFxyXG4gICAgdGhpcy5zcHJpdGUgPSB0aGlzLmdhbWUuYWRkLnNwcml0ZSh0aGlzLmdhbWUud2lkdGggLyAyIC0gMjAsIHRoaXMuZ2FtZS5oZWlnaHQgLSA3NSwgJ3R1cnJldCcpO1xyXG4gICAgdGhpcy5zcHJpdGUuc2NhbGUuc2V0KDAuMjUsMC4yNSk7XHJcbiAgICB0aGlzLnNwcml0ZS5hbmNob3Iuc2V0KDAsIDAuNSk7XHJcbiAgICB0aGlzLnNwcml0ZS52aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5nYW1lLnBoeXNpY3MuZW5hYmxlKHRoaXMuc3ByaXRlLCBQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xyXG4gICAgdGhpcy5zcHJpdGUuYm9keS5hbGxvd1JvdGF0aW9uID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5lbmVteVRpbWVyID0gdGhpcy5nYW1lLnRpbWUuY3JlYXRlKGZhbHNlKTtcclxuICAgIHRoaXMuZW5lbXlUaW1lci5sb29wKHRoaXMuY3VycmVudExldmVsKCkuc3BlZWQsIHRoaXMuY3JlYXRlRW5lbXksIHRoaXMpO1xyXG4gICAgdGhpcy5lbmVteVRpbWVyLnN0YXJ0KCk7XHJcblxyXG4gICAgLy8gRW5lbXkgYW5pbWF0aW9ucyBcclxuICAgIHRoaXMuZW5lbXlEeWluZ0FuaW1hdGlvbnMgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKCk7XHJcblxyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzMDsgaSsrKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBlbmVteUR5aW5nQW5pbWF0aW9uID0gdGhpcy5lbmVteUR5aW5nQW5pbWF0aW9ucy5jcmVhdGUoMCwgMCwgJ2VuZW15ZHlpbmcnLCBbMF0sIGZhbHNlKTtcclxuICAgICAgICBlbmVteUR5aW5nQW5pbWF0aW9uLmFuY2hvci5zZXRUbygwLCAtMC4yNSk7XHJcbiAgICAgICAgZW5lbXlEeWluZ0FuaW1hdGlvbi5hbmltYXRpb25zLmFkZCgnZW5lbXlkeWluZycpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGNvbmNlbnRyYXRlZEZpcmVcclxuICAgIHRoaXMuZXhwbG9zaW9ucyA9IHRoaXMuZ2FtZS5hZGQuZ3JvdXAoKTtcclxuICAgIC8vdGhpcy5leHBsb3Npb25zLmVuYWJsZUJvZHkgPSB0cnVlO1xyXG4gICAgLy90aGlzLmV4cGxvc2lvbnMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xyXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCAxMDsgaisrKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBleHBsb3Npb25BbmltYXRpb24gPSB0aGlzLmV4cGxvc2lvbnMuY3JlYXRlKDAsIDAsICdzbWFsbEV4cGxvc2lvbicsIFswXSwgZmFsc2UpO1xyXG4gICAgICAgIGV4cGxvc2lvbkFuaW1hdGlvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xyXG4gICAgICAgIGV4cGxvc2lvbkFuaW1hdGlvbi5hbmltYXRpb25zLmFkZCgnc21hbGxFeHBsb3Npb24nKTtcclxuICAgIH1cclxuXHJcbiAgICAvL3RoaXMuY29uY2VudHJhdGVkRmlyZUJ1dHRvbiA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLlNQQUNFQkFSKTtcclxuXHJcbiAgICAvL3RoaXMuZW1pdHRlciA9IHRoaXMuZ2FtZS5hZGQuZW1pdHRlcigwLCAwLCAxMDApO1xyXG4gICAgLy90aGlzLmVtaXR0ZXIucGFydGljbGVGcmljdGlvbiA9IDAuMTtcclxuXHJcbiAgfSxcclxuXHJcbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdGhpcy5nYW1lLmRlYnVnLnRleHQodGhpcy5nYW1lLnRpbWUuZnBzIHx8ICctLScsIDIsIDE0LCAnIzAwZmYwMCcpO1xyXG5cclxuICAgIGlmKHRoaXMuZ2FtZW92ZXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8qaWYodGhpcy5lbmVteXNTb2xkaWVycy5sZW5ndGggPCB0aGlzLmVuZW15U29sZGllcnNDb3VudCl7XHJcbiAgICAgIHRoaXMuY3JlYXRlRW5lbXkoKTtcclxuICAgIH0qL1xyXG5cclxuICAgIGlmKCF0aGlzLmVuZW15c1NvbGRpZXJzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKHZhciBpID0gdGhpcy5lbmVteXNTb2xkaWVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICB2YXIgZW5lbXkgPSB0aGlzLmVuZW15c1NvbGRpZXJzW2ldO1xyXG5cclxuICAgICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAodGhpcy5idWxsZXRzLCB0aGlzLmVuZW15c1NvbGRpZXJzW2ldLCB0aGlzLmJ1bGxldEhpdEVuZW15LCBudWxsLCB0aGlzKTtcclxuICAgICAgXHJcbiAgICAgIGlmKGVuZW15LnkgPj0gdGhpcy5nYW1lLmhlaWdodCAtIDE1MCkge1xyXG4gICAgICAgIHRoaXMuc29sZGllcnNDb3VudCAtPSAxO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuZW5lbXlzU29sZGllcnMuc3BsaWNlKGksMSk7XHJcbiAgICAgICAgdGhpcy5zb2xkaWVyc0xlZnRUZXh0LnNldFRleHQodGhpcy5zb2xkaWVyc0NvdW50LnRvU3RyaW5nKCkpO1xyXG5cclxuICAgICAgICB2YXIgZXhwbG9zaW9uZyA9IHRoaXMuZXhwbG9zaW9ucy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XHJcbiAgICAgICAgZXhwbG9zaW9uZy5yZXNldChlbmVteS54LCBlbmVteS55KTtcclxuICAgICAgICBleHBsb3Npb25nLnBsYXkoJ3NtYWxsRXhwbG9zaW9uJywgMzAsIGZhbHNlLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGVuZW15LmRlc3Ryb3koKTtcclxuXHJcbiAgICAgICAgaWYodGhpcy5zb2xkaWVyc0NvdW50IDw9IDApe1xyXG4gICAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdHYW1lT3ZlcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNwcml0ZS5yb3RhdGlvbiA9IHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5hbmdsZVRvUG9pbnRlcih0aGlzLnNwcml0ZSk7XHJcbiAgICBpZiAodGhpcy5nYW1lLmlucHV0LmFjdGl2ZVBvaW50ZXIuaXNEb3duKSB7XHJcbiAgICAgIHRoaXMuc3ByaXRlLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICB0aGlzLmZpcmUoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICB0aGlzLnNwcml0ZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyppZiAodGhpcy5jb25jZW50cmF0ZWRGaXJlQnV0dG9uLmlzRG93bikge1xyXG4gICAgICAgdGhpcy5jb25jZW50cmF0ZWRGaXJlKHRoaXMuZ2FtZS5pbnB1dC5hY3RpdmVQb2ludGVyLnggLSAxMDAsdGhpcy5nYW1lLmlucHV0LmFjdGl2ZVBvaW50ZXIueSAtIDEwMCk7XHJcbiAgICB9Ki9cclxuXHJcbiAgfSxcclxuXHJcbiAgZmlyZTogZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHRoaXMuZ2FtZS50aW1lLm5vdyA+IHRoaXMubmV4dEZpcmUgJiYgdGhpcy5idWxsZXRzLmNvdW50RGVhZCgpID4gMClcclxuICAgIHtcclxuICAgICAgdGhpcy5uZXh0RmlyZSA9IHRoaXMuZ2FtZS50aW1lLm5vdyArIHRoaXMuZmlyZVJhdGU7XHJcbiAgICAgIHZhciBidWxsZXQgPSB0aGlzLmJ1bGxldHMuZ2V0Rmlyc3REZWFkKCk7XHJcbiAgICAgIGJ1bGxldC5yZXNldCh0aGlzLnNwcml0ZS54IC0gMiwgdGhpcy5zcHJpdGUueSAtIDUpO1xyXG4gICAgICBidWxsZXQucm90YXRpb24gPSB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUubW92ZVRvUG9pbnRlcihidWxsZXQsIDE1MDAsIHRoaXMuZ2FtZS5pbnB1dC5hY3RpdmVQb2ludGVyKTtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBjdXJyZW50TGV2ZWw6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLmxldmVsc1t0aGlzLmxldmVsSW5kZXhdO1xyXG4gIH0sXHJcblxyXG4gIG5leHRMZXZlbDogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5sZXZlbEluZGV4Kys7XHJcblxyXG4gICAgaWYodGhpcy5jdXJyZW50TGV2ZWwoKSkge1xyXG4gICAgICBcclxuICAgICAgLy90aGlzLmVuZW15VGltZXIuZGVsYXkgPSB0aGlzLmN1cnJlbnRMZXZlbCgpLnNwZWVkO1xyXG4gICAgICB0aGlzLmVuZW15VGltZXIuZGVzdHJveSgpO1xyXG4gICAgICB0aGlzLmVuZW15VGltZXIgPSB0aGlzLmdhbWUudGltZS5jcmVhdGUoZmFsc2UpO1xyXG4gICAgICB0aGlzLmVuZW15VGltZXIubG9vcCh0aGlzLmN1cnJlbnRMZXZlbCgpLnNwZWVkLCB0aGlzLmNyZWF0ZUVuZW15LCB0aGlzKTtcclxuICAgICAgdGhpcy5lbmVteVRpbWVyLnN0YXJ0KCk7XHJcblxyXG5cclxuICAgICAgdGhpcy5jdXJyZW50TGV2ZWxUZXh0LmRlc3Ryb3koKTtcclxuICAgICAgdGhpcy5jdXJyZW50TGV2ZWxUZXh0ID0gdGhpcy5hZGQuYml0bWFwVGV4dCgwLCAyMCwgJ21pbmVjcmFmdGlhJywgdGhpcy5jdXJyZW50TGV2ZWwoKS5pZCApO1xyXG4gICAgICB0aGlzLmN1cnJlbnRMZXZlbFRleHQueCA9IHRoaXMuZ2FtZS53aWR0aCAtIHRoaXMuY3VycmVudExldmVsVGV4dC50ZXh0V2lkdGggLSAyMDtcclxuXHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdHYW1lT3ZlcicpO1xyXG4gICAgfSAgICBcclxuICB9LFxyXG5cclxuICBjb25jZW50cmF0ZWRGaXJlOiBmdW5jdGlvbiAoeCx5KSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuZXhwbG9zaW9ucy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgdmFyIGV4cGxvc2lvbnNBbmltYXRpb24gPSB0aGlzLmV4cGxvc2lvbnMuZ2V0QXQoaSk7XHJcbiAgICAgICAgICBleHBsb3Npb25zQW5pbWF0aW9uLnJlc2V0KHggKyBNYXRoLnJhbmRvbSgpKjIwMCwgeSArIE1hdGgucmFuZG9tKCkqMjAwKTtcclxuICAgICAgICAgIGV4cGxvc2lvbnNBbmltYXRpb24ucGxheSgnc21hbGxFeHBsb3Npb24nLCAzMCwgZmFsc2UsIHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yICh2YXIgaiA9IHRoaXMuZW5lbXlzU29sZGllcnMubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHtcclxuICAgICAgICAgIHZhciBlbmVteSA9IHRoaXMuZW5lbXlzU29sZGllcnNbal07XHJcbiAgICAgICAgICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAodGhpcy5leHBsb3Npb25zLCBlbmVteSwgdGhpcy5oaXRFbmVteSwgbnVsbCwgdGhpcyk7XHJcbiAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgfSxcclxuXHJcbiAgYnVsbGV0SGl0RW5lbXk6IGZ1bmN0aW9uIChlbmVteSwgYnVsbGV0KSB7XHJcblxyXG4gICAgICAvKnRoaXMuZW1pdHRlci5tYWtlUGFydGljbGVzKCdibG9vZCcpO1xyXG4gICAgICB2YXIgYmxvb2QgPSBuZXcgUGhhc2VyLlJlY3RhbmdsZSgwLCAwLCAzMCwgNSk7XHJcbiAgICAgIHRoaXMuZW1pdHRlci5tYWtlUGFydGljbGVzKGJsb29kKTtcclxuXHJcbiAgICAgIHRoaXMuZW1pdHRlci5yb3RhdGlvbiA9IGJ1bGxldC5yb3RhdGlvbjtcclxuXHJcbiAgICAgIHRoaXMuZW1pdHRlci5ncmF2aXR5ID0gMDtcclxuICAgICAgdGhpcy5lbWl0dGVyLm1heFJvdGF0aW9uID0gMDtcclxuICAgICAgdGhpcy5lbWl0dGVyLm1pblJvdGF0aW9uID0gMDtcclxuXHJcbiAgICAgIHRoaXMuZW1pdHRlci5zZXRBbHBoYSgxLCAwLCA2MDApO1xyXG5cclxuICAgICAgdmFyIHAxID0gbmV3IFBoYXNlci5Qb2ludCAoMSwwKTtcclxuICAgICAgcDEucm90YXRlKDAsMCxidWxsZXQucm90YXRpb24gKyAwLjUpO1xyXG4gICAgICBwMS5zZXRNYWduaXR1ZGUoMjAwKTtcclxuICAgICAgXHJcbiAgICAgIHZhciBwMiA9IG5ldyBQaGFzZXIuUG9pbnQgKDEsMCk7XHJcbiAgICAgIHAyLnJvdGF0ZSgwLDAsYnVsbGV0LnJvdGF0aW9uIC0gMC41KTtcclxuICAgICAgcDIuc2V0TWFnbml0dWRlKDIwMCk7XHJcblxyXG4gICAgICB0aGlzLmVtaXR0ZXIubWF4UGFydGljbGVTcGVlZCA9IHAxO1xyXG4gICAgICB0aGlzLmVtaXR0ZXIubWluUGFydGljbGVTcGVlZCA9IHAyO1xyXG4gICAgICAvL3RoaXMuZW1pdHRlci5yb3RhdGlvbiA9IDA7XHJcbiAgICAgIHRoaXMuZW1pdHRlci54ID0gZW5lbXkueCArIDMwO1xyXG4gICAgICB0aGlzLmVtaXR0ZXIueSA9IGVuZW15LnkgKyAzNTtcclxuXHJcbiAgICAgIHRoaXMuZW1pdHRlci5zdGFydCh0cnVlLCA2MDAsIG51bGwsIDEwKTsqL1xyXG4gICAgICBidWxsZXQua2lsbCgpO1xyXG5cclxuICAgICAgZm9yICh2YXIgaSA9IHRoaXMuZW5lbXlzU29sZGllcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgICBpZihlbmVteSA9PT0gdGhpcy5lbmVteXNTb2xkaWVyc1tpXSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICBlbmVteS5oaXQoKTtcclxuXHJcbiAgICAgICAgICBpZihlbmVteS5oaXRQb2ludHMgPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5lbmVteXNTb2xkaWVycy5zcGxpY2UoaSwxKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBlbmVteUR5aW5nQW5pbWF0aW9uID0gdGhpcy5lbmVteUR5aW5nQW5pbWF0aW9ucy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XHJcbiAgICAgICAgICAgIGVuZW15RHlpbmdBbmltYXRpb24ucmVzZXQoZW5lbXkueCwgZW5lbXkueSk7XHJcbiAgICAgICAgICAgIGVuZW15RHlpbmdBbmltYXRpb24uYWxwaGEgPSAxO1xyXG4gICAgICAgICAgICBlbmVteUR5aW5nQW5pbWF0aW9uLnBsYXkoJ2VuZW15ZHlpbmcnLCAzMCwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5nYW1lLnRpbWUuZXZlbnRzLmFkZChQaGFzZXIuVGltZXIuU0VDT05EICogMSwgdGhpcy5mYWRlQW5pbWF0aW9uLCB0aGlzLCBlbmVteUR5aW5nQW5pbWF0aW9uKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmKGVuZW15LmhpdFBvaW50cyA9PT0gMCkge1xyXG4gICAgICAgIGVuZW15LmtpbGwoKTtcclxuICAgICAgICB0aGlzLmdhbWUuZW5lbXlLaWxsZWQrKztcclxuXHJcbiAgICAgICAgaWYodGhpcy5nYW1lLmVuZW15S2lsbGVkID49IHRoaXMuY3VycmVudExldmVsKCkubGVuZ3RoKXtcclxuICAgICAgICAgIHRoaXMubmV4dExldmVsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvL3ZhciBkZXN0cm95ZWQgPSBlbmVtaWVzW3RhbmsubmFtZV0uZGFtYWdlKCk7XHJcblxyXG4gICAgICAvKmlmIChkZXN0cm95ZWQpXHJcbiAgICAgIHtcclxuICAgICAgICAgIHZhciBleHBsb3Npb25BbmltYXRpb24gPSBleHBsb3Npb25zLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcclxuICAgICAgICAgIGV4cGxvc2lvbkFuaW1hdGlvbi5yZXNldCh0YW5rLngsIHRhbmsueSk7XHJcbiAgICAgICAgICBleHBsb3Npb25BbmltYXRpb24ucGxheSgna2Fib29tJywgMzAsIGZhbHNlLCB0cnVlKTtcclxuICAgICAgfSovXHJcbiAgfSxcclxuXHJcbiAgZmFkZUFuaW1hdGlvbjogZnVuY3Rpb24gKGFuaW1hdGlvbikge1xyXG4gICAgLy9jb25zb2xlLmxvZyhcIi0tLS0tXCIpO1xyXG4gICAgLy9jb25zb2xlLmxvZyhhbmltYXRpb24pO1xyXG4gICAgdmFyIGZhZGVBbmltID0gdGhpcy5nYW1lLmFkZC50d2VlbihhbmltYXRpb24pLnRvKCB7IGFscGhhOiAwIH0sIDEwMDAsIFBoYXNlci5FYXNpbmcuTGluZWFyLk5vbmUsIHRydWUpO1xyXG4gICAgZmFkZUFuaW0ub25Db21wbGV0ZS5hZGQoZnVuY3Rpb24gKCkgeyB0aGlzLnJlbW92ZVR3ZWVuKGFuaW1hdGlvbik7IH0sIHRoaXMpO1xyXG5cclxuICB9LFxyXG5cclxuICBoaXRFbmVteTogZnVuY3Rpb24gKGVuZW15KSB7XHJcbiAgICBmb3IgKHZhciBpID0gdGhpcy5lbmVteXNTb2xkaWVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICBpZihlbmVteSA9PT0gdGhpcy5lbmVteXNTb2xkaWVyc1tpXSlcclxuICAgICAge1xyXG4gICAgICAgIHRoaXMuZW5lbXlzU29sZGllcnMuc3BsaWNlKGksMSk7XHJcblxyXG4gICAgICAgIHZhciBlbmVteUR5aW5nQW5pbWF0aW9uID0gdGhpcy5lbmVteUR5aW5nQW5pbWF0aW9ucy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XHJcbiAgICAgICAgZW5lbXlEeWluZ0FuaW1hdGlvbi5yZXNldChlbmVteS54LCBlbmVteS55KTtcclxuICAgICAgICBlbmVteUR5aW5nQW5pbWF0aW9uLnBsYXkoJ2VuZW15ZHlpbmcnLCAzMCwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZW5lbXkua2lsbCgpO1xyXG4gIH0sXHJcblxyXG4gIHJlbW92ZVR3ZWVuOiBmdW5jdGlvbiAoYW5pbWF0aW9uKSB7XHJcbiAgICBhbmltYXRpb24ua2lsbCgpO1xyXG4gIH0sXHJcbiAga2lsbEFuaW1hdGlvbjogZnVuY3Rpb24gKGFuaW1hdGlvbikge1xyXG4gICAgLy9jb25zb2xlLmxvZyhcInRoaXMuZW5lbXlEeWluZ0FuaW1hdGlvbnNcIik7XHJcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMuZW5lbXlEeWluZ0FuaW1hdGlvbnMpO1xyXG4gIH0sXHJcblxyXG4gIGNoZWNrT3ZlcmxhcEVuZW15WDogZnVuY3Rpb24gKCkge1xyXG4gICAgXHJcbiAgICBcclxuXHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlRW5lbXk6IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB2YXIgZW5lbXlYID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHRoaXMuZ2FtZS53aWR0aCAtIDY1KSk7XHJcblxyXG4gICAgLyp2YXIgcGFzcyA9IHRydWU7XHJcbiAgICBmb3IgKHZhciBpID0gdGhpcy5lbmVteXNTb2xkaWVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICB2YXIgc29sZGllciA9IHRoaXMuZW5lbXlzU29sZGllcnNbaV07XHJcblxyXG4gICAgICBpZihlbmVteVggPCBzb2xkaWVyLnggKyA2NSAmJiBlbmVteVggPiBzb2xkaWVyLnggLSA2NSApIHtcclxuICAgICAgICBwYXNzID0gZmFsc2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9Ki9cclxuXHJcbiAgICAvKmlmKCFwYXNzKXtcclxuICAgICAgdGhpcy5jcmVhdGVFbmVteSgpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9Ki9cclxuXHJcbiAgICB2YXIgZW5lbXkgPSBuZXcgRW5lbXkodGhpcy5nYW1lLCBlbmVteVgsIDApO1xyXG4gICAgdGhpcy5nYW1lLnBoeXNpY3MuZW5hYmxlKGVuZW15LCBQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xyXG4gICAgdGhpcy5lbmVteXNTb2xkaWVycy5wdXNoKGVuZW15KTtcclxuICAgIFxyXG4gIH0sXHJcblxyXG4gIGNoZWNrT3ZlcmxhcDogZnVuY3Rpb24gKHNwcml0ZUEsIHNwcml0ZUIpIHtcclxuICAgIHZhciBib3VuZHNBID0gc3ByaXRlQS5nZXRCb3VuZHMoKTtcclxuICAgIHZhciBib3VuZHNCID0gc3ByaXRlQi5nZXRCb3VuZHMoKTtcclxuXHJcbiAgICByZXR1cm4gUGhhc2VyLlJlY3RhbmdsZS5pbnRlcnNlY3RzKGJvdW5kc0EsIGJvdW5kc0IpO1xyXG4gIH0sXHJcblxyXG4gIGVuZEdhbWU6IGZ1bmN0aW9uICgpIHtcclxuICAgIFxyXG4gIH0sXHJcblxyXG4gIG9uSW5wdXREb3duOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcclxuICB9XHJcbn07XHJcbiIsInZhciBHYW1lb3ZlciA9IGZ1bmN0aW9uICgpIHt9O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBHYW1lb3ZlcjtcclxuXHJcbkdhbWVvdmVyLnByb3RvdHlwZSA9IHtcclxuXHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgeCA9IHRoaXMuZ2FtZS53aWR0aCAvIDJcclxuICAgICAgLCB5ID0gdGhpcy5nYW1lLmhlaWdodCAvIDI7XHJcblxyXG4gICAgdGhpcy50aXRsZVR4dCA9IHRoaXMuYWRkLmJpdG1hcFRleHQoeCwgeSwgJ21pbmVjcmFmdGlhJywgJ0tpbGxlZDogJyArIHRoaXMuZ2FtZS5lbmVteUtpbGxlZCApO1xyXG4gICAgdGhpcy50aXRsZVR4dC5hbGlnbiA9ICdjZW50ZXInO1xyXG4gICAgdGhpcy50aXRsZVR4dC54ID0gdGhpcy5nYW1lLndpZHRoIC8gMiAtIHRoaXMudGl0bGVUeHQudGV4dFdpZHRoIC8gMjtcclxuXHJcbiAgICAvL3kgPSB5ICsgdGhpcy50aXRsZVR4dC5oZWlnaHQgKyA1O1xyXG4gICAgdGhpcy5zdGFydFR4dCA9IHRoaXMuYWRkLmJpdG1hcFRleHQoeCwgeSArIDUwLCAnbWluZWNyYWZ0aWEnLCAnR0FNRSBPVkVSJyk7XHJcbiAgICB0aGlzLnN0YXJ0VHh0LmFsaWduID0gJ2NlbnRlcic7XHJcbiAgICB0aGlzLnN0YXJ0VHh0LnggPSB0aGlzLmdhbWUud2lkdGggLyAyIC0gdGhpcy5zdGFydFR4dC50ZXh0V2lkdGggLyAyO1xyXG4gICAgXHJcbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xyXG4gIH0sXHJcblxyXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xyXG5cclxuICB9LFxyXG5cclxuICBvbkRvd246IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xyXG4gICAgLy90aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ0dhbWVvdmVyJyk7XHJcbiAgfVxyXG59O1xyXG4iLCJ2YXIgTWVudSA9IGZ1bmN0aW9uICgpIHtcclxuICB0aGlzLnRleHQgPSBudWxsO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xyXG5cclxuTWVudS5wcm90b3R5cGUgPSB7XHJcblxyXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyXHJcbiAgICAgICwgeSA9IHRoaXMuZ2FtZS5oZWlnaHQgLyAyO1xyXG5cclxuICAgIFxyXG4gICAgdGhpcy5sb2dvVGV4dCA9IHRoaXMuYWRkLmJpdG1hcFRleHQoeCwgeSAtIDIwMCwgJ21pbmVjcmFmdGlhJywgJ0xTRycsIDE2NCApO1xyXG4gICAgdGhpcy5sb2dvVGV4dC5hbGlnbiA9ICdjZW50ZXInO1xyXG4gICAgdGhpcy5sb2dvVGV4dC54ID0gdGhpcy5nYW1lLndpZHRoIC8gMiAtIHRoaXMubG9nb1RleHQudGV4dFdpZHRoIC8gMjtcclxuXHJcbiAgICB0aGlzLmRlc2NpcHRpb25UeHQgPSB0aGlzLmFkZC5iaXRtYXBUZXh0KHgsIHkgKyAxMCwgJ21pbmVjcmFmdGlhJywgJ0xJVFRMRSBTSElUVFkgR0FNRVMnLCAyNyApO1xyXG4gICAgdGhpcy5kZXNjaXB0aW9uVHh0LmFsaWduID0gJ2NlbnRlcic7XHJcbiAgICB0aGlzLmRlc2NpcHRpb25UeHQueCA9IHRoaXMuZ2FtZS53aWR0aCAvIDIgLSB0aGlzLmRlc2NpcHRpb25UeHQudGV4dFdpZHRoIC8gMjtcclxuXHJcbiAgICB0aGlzLnRpdGxlVHh0ID0gdGhpcy5hZGQuYml0bWFwVGV4dCh4LCB5ICsgMTAwLCAnbWluZWNyYWZ0aWEnLCAnTmFhcHVyaW5rYXVodScgKTtcclxuICAgIHRoaXMudGl0bGVUeHQuYWxpZ24gPSAnY2VudGVyJztcclxuICAgIHRoaXMudGl0bGVUeHQueCA9IHRoaXMuZ2FtZS53aWR0aCAvIDIgLSB0aGlzLnRpdGxlVHh0LnRleHRXaWR0aCAvIDI7XHJcblxyXG4gICAgdGhpcy5zdGFydFR4dCA9IHRoaXMuYWRkLmJpdG1hcFRleHQoeCwgdGhpcy5nYW1lLmhlaWdodCAtIHRoaXMudGl0bGVUeHQuaGVpZ2h0IC0gMTUsICdtaW5lY3JhZnRpYScsICdQcmVzcyBzY3JlZW4gdG8gc3RhcnQnKTtcclxuICAgIHRoaXMuc3RhcnRUeHQuYWxpZ24gPSAnY2VudGVyJztcclxuICAgIHRoaXMuc3RhcnRUeHQueCA9IHRoaXMuZ2FtZS53aWR0aCAvIDIgLSB0aGlzLnN0YXJ0VHh0LnRleHRXaWR0aCAvIDI7XHJcblxyXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMub25Eb3duLCB0aGlzKTtcclxuICB9LFxyXG5cclxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgfSxcclxuXHJcbiAgb25Eb3duOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ0dhbWUnKTtcclxuICAgIC8vdGhpcy5nYW1lLnNjYWxlLnN0YXJ0RnVsbFNjcmVlbigpO1xyXG4gIH1cclxufTtcclxuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XHJcbiAgdGhpcy5hc3NldCA9IG51bGw7XHJcbiAgdGhpcy5yZWFkeSA9IGZhbHNlO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQcmVsb2FkZXI7XHJcblxyXG5QcmVsb2FkZXIucHJvdG90eXBlID0ge1xyXG5cclxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHRoaXMuYXNzZXQgPSB0aGlzLmFkZC5zcHJpdGUodGhpcy5nYW1lLndpZHRoIC8gMiwgdGhpcy5nYW1lLmhlaWdodCAvIDIsICdwcmVsb2FkZXInKTtcclxuICAgICAgdGhpcy5hc3NldC5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xyXG5cclxuICAgICAgdGhpcy5sb2FkLm9uTG9hZENvbXBsZXRlLmFkZE9uY2UodGhpcy5vbkxvYWRDb21wbGV0ZSwgdGhpcyk7XHJcbiAgICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xyXG4gICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ2thYm9vbScsICdhc3NldHMvZXhwbG9zaW9uLnBuZycsIDY0LCA2NCwgMjMpO1xyXG4gICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ2JpZ0V4cGxvc2lvbicsICdhc3NldHMvYmlnLWV4cGxvc2lvbi5wbmcnLCAyNTYsIDEyOCwgMTIpO1xyXG4gICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ3NtYWxsRXhwbG9zaW9uJywgJ2Fzc2V0cy9zbWFsbC1leHBsb3Npb24ucG5nJywgOTYsIDk2LCA0OCk7XHJcbiAgICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldCgnZW5lbXlkeWluZycsICdhc3NldHMvZW5lbXlkeWluZy5wbmcnLCA2MywgNjQsIDIwKTtcclxuICAgICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdlbmVteVNwcml0ZScsICdhc3NldHMvZW5lbXkucG5nJywgNjQsIDY0LCAxNSk7XHJcbiAgICAgIHRoaXMubG9hZC5pbWFnZSgnYmcnLCAnYXNzZXRzL2JnLnBuZycpO1xyXG4gICAgICB0aGlzLmxvYWQuaW1hZ2UoJ2Jsb29kJywgJ2Fzc2V0cy9ibG9vZC5qcGcnKTtcclxuICAgICAgdGhpcy5sb2FkLmltYWdlKCdlYXJ0aCcsICdhc3NldHMvZWFydGgucG5nJyk7XHJcbiAgICAgIHRoaXMubG9hZC5pbWFnZSgnZW5lbXknLCAnYXNzZXRzL2ludmFkZXIucG5nJyk7XHJcbiAgICAgIHRoaXMubG9hZC5pbWFnZSgndHVycmV0JywgJ2Fzc2V0cy90dXJyZXQucG5nJyk7XHJcbiAgICAgIHRoaXMubG9hZC5pbWFnZSgndHVycmV0aG9sZGVyJywgJ2Fzc2V0cy9ndW4taG9sZGVyLnBuZycpO1xyXG4gICAgICB0aGlzLmxvYWQuaW1hZ2UoJ2J1bGxldCcsICdhc3NldHMvYnVsbGV0LnBuZycpO1xyXG4gICAgICB0aGlzLmxvYWQuYml0bWFwRm9udCgnbWluZWNyYWZ0aWEnLCAnYXNzZXRzL21pbmVjcmFmdGlhLnBuZycsICdhc3NldHMvbWluZWNyYWZ0aWEueG1sJyk7XHJcbiAgICAgIHRoaXMubG9hZC5hdWRpbygnc2Z4JywgJ2Fzc2V0cy9hdWRpby9Tb3VuZEVmZmVjdHMvZnhfbWl4ZG93bi5vZ2cnKTtcclxuICB9LFxyXG5cclxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuYXNzZXQuY3JvcEVuYWJsZWQgPSBmYWxzZTtcclxuICB9LFxyXG5cclxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICghIXRoaXMucmVhZHkpIHtcclxuICAgICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcclxuICAgICAgfVxyXG4gIH0sXHJcblxyXG4gIG9uTG9hZENvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcclxuICB9XHJcbn07XHJcbiIsInZhciBVdGlscyA9IHtcclxuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbihvYmosIGxpc3QpIHtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBVdGlsczsiXX0=
